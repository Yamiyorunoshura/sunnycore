# 實作計劃

- [x] 1. 建立核心架構基礎
  - 建立基礎抽象類別和介面，為整個系統提供統一的架構基礎
  - 實作 BaseService 和 BasePanel 抽象類別
  - 建立錯誤處理類別層次結構
  - 建立資料庫管理器基礎架構
  - _需求：1.1, 1.2, 1.3, 1.4_

  - [x] 1.1 實作基礎服務抽象類別
    - 建立 `core/base_service.py` 檔案
    - 實作 BaseService 抽象類別，包含初始化、清理和權限驗證方法
    - 建立服務註冊和依賴注入機制
    - 撰寫 BaseService 的單元測試
    - _需求：1.1, 1.2_

  - [x] 1.2 實作基礎面板抽象類別
    - 建立 `panels/base_panel.py` 檔案
    - 實作 BasePanel 抽象類別，包含嵌入訊息建立和互動處理方法
    - 實作通用的錯誤和成功訊息發送方法
    - 撰寫 BasePanel 的單元測試
    - _需求：1.1, 1.3_

  - [x] 1.3 建立錯誤處理系統
    - 建立 `core/exceptions.py` 檔案
    - 實作完整的錯誤類別層次結構（BotError, ServiceError, DatabaseError 等）
    - 建立全域錯誤處理裝飾器
    - 實作錯誤記錄和報告機制
    - _需求：11.3, 11.4_

  - [x] 1.4 重構現有資料庫管理器
    - 修改 `cogs/database.py` 以符合新的架構模式
    - 實作 DatabaseManager 類別，整合現有的 Database Cog
    - 建立資料庫連線池和事務管理
    - 撰寫資料庫管理器的整合測試
    - _需求：11.1, 11.2_

- [x] 2. 實作經濟系統核心功能
  - 建立經濟系統的核心業務邏輯，包括帳戶管理、交易處理和貨幣設定
  - 實作多種帳戶類型支援（使用者、政府理事會、政府部門）
  - 建立完整的交易記錄和審計機制
  - _需求：4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4, 8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4, 9.5_

  - [x] 2.1 建立經濟系統資料模型
    - 建立 `services/economy/models.py` 檔案
    - 實作 AccountType 枚舉和相關資料類別
    - 建立經濟系統相關的資料庫表格結構
    - 撰寫資料模型的遷移腳本
    - _需求：4.3, 5.4, 8.1, 9.1_

  - [x] 2.2 實作經濟服務核心邏輯
    - 建立 `services/economy/economy_service.py` 檔案
    - 實作 EconomyService 類別，包含帳戶管理和交易處理方法
    - 實作帳戶建立、餘額查詢、轉帳等核心功能
    - 建立交易記錄和審計機制
    - _需求：4.1, 4.2, 5.1, 5.2, 8.2, 8.4, 9.2, 9.5_

  - [x] 2.3 實作貨幣設定管理
    - 在 EconomyService 中實作貨幣配置管理方法
    - 建立貨幣名稱和符號的設定功能
    - 實作貨幣設定的驗證和更新機制
    - 撰寫貨幣設定的單元測試
    - _需求：5.3, 5.4_

  - [ ] 2.4 建立經濟系統單元測試
    - 建立 `tests/services/test_economy_service.py` 檔案
    - 撰寫所有經濟服務方法的單元測試
    - 測試帳戶建立、轉帳、餘額查詢等功能
    - 測試錯誤情況和邊界條件
    - _需求：4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4_

- [x] 3. 實作經濟系統使用者介面
  - 建立經濟系統的使用者面板和管理員面板
  - 實作餘額查詢、交易記錄查看等使用者功能
  - 實作管理員的餘額管理和貨幣設定功能
  - _需求：4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4_

  - [x] 3.1 建立經濟面板基礎結構
    - 建立 `panels/economy_panel.py` 檔案
    - 實作 EconomyPanel 類別，繼承自 BasePanel
    - 建立經濟面板的基礎嵌入訊息模板
    - 實作權限檢查和錯誤處理
    - _需求：4.1, 5.1_

  - [x] 3.2 實作使用者經濟面板功能
    - 實作餘額查詢功能的互動介面
    - 建立交易記錄查看功能
    - 實作貨幣顯示格式化（使用配置的符號和名稱）
    - 撰寫使用者面板的互動測試
    - _需求：4.1, 4.2, 4.3_

  - [x] 3.3 實作管理員經濟面板功能
    - 實作管理員餘額管理介面
    - 建立貨幣設定配置面板
    - 實作使用者帳戶搜尋和管理功能
    - 建立管理操作的確認對話框
    - _需求：5.1, 5.2, 5.3, 5.4_

  - [ ] 3.4 建立經濟面板 Cog 整合
    - 建立 `cogs/economy.py` 檔案
    - 實作經濟系統的斜線指令
    - 整合 EconomyService 和 EconomyPanel
    - 撰寫 Cog 的整合測試
    - _需求：4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4_

- [x] 4. 實作政府系統核心功能
  - 建立政府系統的核心業務邏輯，包括部門管理、身分組管理和註冊表維護
  - 實作常任理事會和部門的獨立帳戶系統
  - 建立完整的部門註冊表和身分組階層管理
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 10.1, 10.2, 10.3, 10.4, 10.5_

  - [x] 4.1 建立政府系統資料模型
    - 建立 `services/government/models.py` 檔案
    - 實作 DepartmentRegistry 資料類別
    - 建立政府系統相關的資料庫表格結構
    - 實作 JSON 註冊表的讀寫機制
    - _需求：7.1, 7.7_

  - [x] 4.2 實作身分組管理服務
    - 建立 `services/government/role_service.py` 檔案
    - 實作 RoleService 類別，包含身分組建立和階層管理
    - 實作常任理事身分組的自動建立機制
    - 建立部門身分組的建立和管理功能
    - _需求：6.2, 7.2, 7.3, 7.5, 10.1, 10.2, 10.3, 10.4, 10.5_

  - [x] 4.3 實作政府服務核心邏輯
    - 建立 `services/government/government_service.py` 檔案
    - 實作 GovernmentService 類別，包含部門管理方法
    - 整合 RoleService 和 EconomyService 以支援部門帳戶
    - 實作部門註冊表的 CRUD 操作
    - _需求：6.3, 6.4, 6.5, 7.4, 7.6, 8.1, 9.1_

  - [x] 4.4 建立政府系統單元測試
    - 建立 `tests/services/test_government_service.py` 檔案
    - 撰寫政府服務和身分組服務的單元測試
    - 測試部門建立、更新、刪除等功能
    - 測試身分組階層和權限管理
    - _需求：6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 5. 實作政府系統使用者介面
  - 建立政府系統的常任理事會面板
  - 實作部門管理的互動介面
  - 建立部門註冊表的查看和編輯功能
  - _需求：6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

  - [ ] 5.1 建立政府面板基礎結構
    - 建立 `panels/government/government_panel.py` 檔案
    - 實作 GovernmentPanel 類別，繼承自 BasePanel
    - 建立常任理事會權限檢查機制
    - 實作政府面板的基礎嵌入訊息模板
    - _需求：6.1, 6.2_

  - [ ] 5.2 實作部門管理介面
    - 實作部門建立的模態對話框
    - 建立部門資訊編輯和刪除功能
    - 實作部門負責人指派介面
    - 建立部門級別設定功能
    - _需求：6.3, 6.4, 6.5, 7.2, 7.4, 7.5, 7.6_

  - [ ] 5.3 實作註冊表查看功能
    - 建立部門註冊表的顯示介面
    - 實作註冊表的搜尋和篩選功能
    - 建立部門詳情查看面板
    - 實作註冊表的匯出功能
    - _需求：7.1, 7.7_

  - [ ] 5.4 建立政府面板 Cog 整合
    - 修改現有的 `cogs/government.py` 檔案
    - 實作政府系統的斜線指令
    - 整合 GovernmentService 和 GovernmentPanel
    - 撰寫 Cog 的整合測試
    - _需求：6.1, 6.2, 6.3, 6.4, 6.5, 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7_

- [ ] 6. 實作成就系統核心功能
  - 建立成就系統的核心業務邏輯，包括成就管理、進度追蹤和獎勵發放
  - 實作成就觸發機制和自動檢查系統
  - 建立完整的成就進度管理和統計功能
  - _需求：2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

  - [ ] 6.1 建立成就系統資料模型
    - 建立 `services/achievement/models.py` 檔案
    - 實作成就和進度相關的資料類別
    - 建立成就系統相關的資料庫表格結構
    - 實作成就觸發條件的 JSON 結構定義
    - _需求：2.2, 2.4, 3.2_

  - [ ] 6.2 實作成就服務核心邏輯
    - 建立 `services/achievement/achievement_service.py` 檔案
    - 實作 AchievementService 類別，包含成就管理方法
    - 建立成就進度追蹤和更新機制
    - 實作成就觸發條件檢查系統
    - _需求：2.1, 2.2, 2.3, 2.4, 3.1, 3.2_

  - [ ] 6.3 實作成就獎勵系統
    - 建立成就獎勵的發放機制
    - 實作身分組獎勵的自動授予功能
    - 整合經濟系統以支援貨幣獎勵
    - 建立獎勵發放的記錄和追蹤
    - _需求：2.3, 3.5_

  - [ ] 6.4 建立成就系統單元測試
    - 建立 `tests/services/test_achievement_service.py` 檔案
    - 撰寫成就服務所有方法的單元測試
    - 測試成就建立、進度更新、獎勵發放等功能
    - 測試成就觸發條件的各種情況
    - _需求：2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [ ] 7. 實作成就系統使用者介面
  - 建立成就系統的使用者面板和管理員面板
  - 實作成就進度查看和詳情顯示功能
  - 實作管理員的成就管理和配置功能
  - _需求：2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

  - [ ] 7.1 建立成就面板基礎結構
    - 建立 `panels/achievement/achievement_panel.py` 檔案
    - 實作 AchievementPanel 類別，繼承自 BasePanel
    - 建立成就面板的基礎嵌入訊息模板
    - 實作成就圖示和進度條的顯示功能
    - _需求：2.1, 2.2_

  - [ ] 7.2 實作使用者成就面板功能
    - 實作使用者成就列表顯示功能
    - 建立成就詳情查看面板
    - 實作成就進度的視覺化顯示
    - 建立成就獎勵的查看功能
    - _需求：2.1, 2.2, 2.3, 2.4_

  - [ ] 7.3 實作管理員成就面板功能
    - 實作成就建立和編輯的模態對話框
    - 建立成就可見性設定功能
    - 實作成就獎勵配置介面
    - 建立成就統計和分析面板
    - _需求：3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

  - [ ] 7.4 建立成就面板 Cog 整合
    - 建立 `cogs/achievement.py` 檔案
    - 實作成就系統的斜線指令
    - 整合 AchievementService 和 AchievementPanel
    - 撰寫 Cog 的整合測試
    - _需求：2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [ ] 8. 建立資料庫遷移腳本
  - 建立完整的資料庫遷移腳本以支援新系統
  - 確保與現有資料的相容性
  - 實作資料遷移和升級程序
  - _需求：11.1, 11.2, 11.5_

  - [ ] 8.1 建立經濟系統遷移腳本
    - 建立 `scripts/migrations/001_create_economy_tables.sql` 檔案
    - 定義經濟系統所需的資料庫表格結構
    - 建立索引和約束條件
    - 撰寫資料遷移驗證腳本
    - _需求：11.1, 11.2_

  - [ ] 8.2 建立政府系統遷移腳本
    - 建立 `scripts/migrations/002_create_government_tables.sql` 檔案
    - 定義政府系統所需的資料庫表格結構
    - 建立外鍵關聯和索引
    - 撰寫資料完整性檢查腳本
    - _需求：11.1, 11.2_

  - [ ] 8.3 建立成就系統遷移腳本
    - 建立 `scripts/migrations/003_create_achievement_tables.sql` 檔案
    - 定義成就系統所需的資料庫表格結構
    - 建立觸發條件和進度追蹤表格
    - 撰寫成就資料驗證腳本
    - _需求：11.1, 11.2_

- [ ] 9. 重構現有模組以符合新架構
  - 將現有的歡迎系統、訊息監聽器等模組重構為新的架構模式
  - 確保所有模組都遵循前後端分離的設計原則
  - 整合現有功能與新的服務層架構
  - _需求：1.1, 1.2, 1.3, 1.4_

  - [ ] 9.1 重構歡迎系統模組
    - 將現有的歡迎功能分離為 WelcomeService 和 WelcomePanel
    - 修改 `cogs/welcome/welcome.py` 以符合新的架構模式
    - 確保向後相容性和資料遷移
    - 撰寫重構後的整合測試
    - _需求：1.1, 1.3_

  - [ ] 9.2 重構訊息監聽器模組
    - 將訊息處理邏輯分離為 MessageService 和相關面板
    - 修改 `cogs/message_listener/message_listener.py` 以符合新架構
    - 整合成就系統的觸發機制
    - 確保效能和穩定性
    - _需求：1.1, 1.2_

  - [ ] 9.3 重構活躍度系統模組
    - 將活躍度計算邏輯分離為 ActivityService
    - 整合成就系統以支援活躍度相關成就
    - 修改現有的活躍度面板以符合新架構
    - 撰寫活躍度系統的整合測試
    - _需求：1.1, 1.3_

  - [ ] 9.4 更新主程式和配置
    - 修改 `main.py` 以支援新的服務註冊機制
    - 更新 `config.py` 以包含新系統的配置選項
    - 建立服務依賴注入和初始化流程
    - 確保所有模組的正確載入和初始化
    - _需求：1.1, 1.2, 1.4_

- [ ] 10. 建立系統整合測試
  - 建立完整的端到端測試套件
  - 測試所有系統間的互動和整合
  - 驗證資料一致性和業務流程
  - _需求：11.1, 11.2, 11.3, 11.4, 11.5_

  - [ ] 10.1 建立端到端測試框架
    - 建立 `tests/integration/` 目錄結構
    - 實作測試資料庫和模擬 Discord 環境
    - 建立測試資料的建立和清理機制
    - 撰寫測試工具和輔助函數
    - _需求：11.1, 11.2_

  - [ ] 10.2 撰寫跨系統整合測試
    - 測試成就系統與經濟系統的整合（貨幣獎勵）
    - 測試政府系統與經濟系統的整合（部門帳戶）
    - 測試身分組管理與所有系統的整合
    - 驗證資料一致性和事務完整性
    - _需求：8.1, 8.2, 8.3, 8.4, 9.1, 9.2, 9.3, 9.4, 9.5_

  - [ ] 10.3 建立效能和負載測試
    - 測試系統在高負載下的表現
    - 驗證資料庫查詢效能
    - 測試並發操作的正確性
    - 建立效能基準和監控
    - _需求：11.1, 11.2, 11.4_

  - [ ] 10.4 撰寫使用者流程測試
    - 測試完整的使用者操作流程
    - 驗證所有面板和互動的正確性
    - 測試錯誤處理和恢復機制
    - 確保使用者體驗的一致性
    - _需求：2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 6.1, 6.2, 6.3, 6.4, 6.5_

- [ ] 11. 建立文件和部署準備
  - 建立完整的系統文件和使用指南
  - 準備部署腳本和配置檔案
  - 建立資料遷移和升級程序
  - _需求：11.5_

  - [ ] 11.1 撰寫技術文件
    - 建立 API 文件和開發者指南
    - 撰寫架構說明和設計決策文件
    - 建立故障排除和維護指南
    - 撰寫效能調優建議
    - _需求：11.5_

  - [ ] 11.2 建立使用者文件
    - 撰寫使用者操作手冊
    - 建立管理員配置指南
    - 製作功能介紹和教學影片腳本
    - 建立常見問題解答
    - _需求：2.1, 2.2, 2.3, 2.4, 4.1, 4.2, 4.3, 5.1, 5.2, 5.3, 5.4, 6.1, 6.2, 6.3, 6.4, 6.5_

  - [ ] 11.3 準備部署和遷移工具
    - 建立資料庫遷移腳本
    - 撰寫部署自動化腳本
    - 建立配置檔案模板
    - 準備備份和恢復程序
    - _需求：11.1, 11.2, 11.5_

  - [ ] 11.4 建立監控和維護工具
    - 實作系統健康檢查功能
    - 建立效能監控和警報機制
    - 撰寫日誌分析和報告工具
    - 建立自動化維護任務
    - _需求：11.3, 11.4, 11.5_