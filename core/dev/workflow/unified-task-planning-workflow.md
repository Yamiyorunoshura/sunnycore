# 統一任務規劃工作流程

<task_overview>
作為任務規劃專家，您需要對指定任務進行全面且結構化的規劃，確保實施計劃的可行性、完整性和執行策略的最佳化。
</task_overview>

## 核心規劃階段

<optimization_phases>

### 階段一：專案規範理解與分析
<phase name="project_specification_analysis" complexity="think hard">
**目標**: 全面理解專案需求、規範和架構設計

**執行步驟**:
1. **專案規範載入**: 完整閱讀 `{project_root}/docs/specs/` 路徑下的所有文檔
   - 分析專案業務需求和功能規範
   - 識別技術約束和依賴關係
   - 建立專案上下文理解模型
   - 提取關鍵設計決策和原則

2. **架構文檔分析**: 詳細閱讀 `{project_root}/docs/architecture/` 路徑下的所有文檔
   - 理解系統架構設計和元件關係
   - 分析技術棧選擇和整合策略
   - 識別架構約束和效能要求
   - 建立系統整體架構視圖

**驗證檢查點**:
- [ ] 專案需求已完整理解和記錄
- [ ] 架構設計已全面分析和掌握
- [ ] 技術約束和依賴關係已識別
- [ ] 專案上下文模型已建立

**預期成果**: 建立完整的專案理解基礎，為後續任務規劃提供準確的上下文支援
</phase>

### 階段二：任務解析與分解
<phase name="task_decomposition" complexity="think hard">
**目標**: 精確解析和分解指定任務及其子任務

**執行步驟**:
3. **任務檔案解析**: 閱讀 task.md 檔案並進行結構化分析
   - 定位符合 `{task_id}` 的主要任務（例如：1, 2, 3）
   - 提取該任務下所有子任務（例如：1.1, 1.2, 1.3）
   - 收集每個任務和子任務的無序列表項
   - 分析任務間的依賴關係和執行順序

4. **任務顆粒度分解**: 將任務分解為最小執行單位
   - 將無序列表項轉換為具體的功能需求（F-1, F-2...）
   - 識別非功能性需求（N-1, N-2...）
   - 定義每個需求的驗收條件和測量標準
   - 建立任務執行的優先級排序

**驗證檢查點**:
- [ ] 指定任務及子任務已正確識別
- [ ] 任務需求已分解為最小執行單位
- [ ] 功能和非功能需求已明確分類
- [ ] 驗收條件已定義完整

**預期成果**: 產生結構化、可執行的任務分解結果，為實施計劃奠定基礎
</phase>

### 階段三：實施計劃生成與輸出
<phase name="implementation_plan_generation" complexity="think harder">
**目標**: 基於模板生成完整的實施計劃文檔

**執行步驟**:
5. **模板載入與理解**: 閱讀模板 `~/cursor-claude/core/dev/templates/implementation-plan-tmpl.yaml`
   - 理解模板結構和必填欄位要求
   - 分析輸出格式規範和品質標準
   - 準備符合模板要求的規劃內容

6. **計劃內容填入**: 將任務規劃結果系統性填入模板
   - 填寫專案元資料和上下文資訊
   - 對應功能和非功能需求到模板結構
   - 完善執行步驟和驗證機制
   - 確保內容完整性和一致性

7. **文檔輸出與格式化**: 生成最終的實施計劃文檔
   - 將完成的計劃轉換為 Markdown 格式
   - 輸出到 `{project_root}/docs/implementation-plan/` 路徑
   - 使用規範的檔案命名：`{task_id}-plan.md`（例如：1-plan.md, 2-plan.md）
   - 執行最終的格式和內容驗證

**驗證檢查點**:
- [ ] 模板已正確載入和理解
- [ ] 所有必填欄位已完整填寫
- [ ] 計劃內容符合模板規範要求
- [ ] 文檔已成功輸出到指定路徑
- [ ] 檔案命名符合規範標準

**預期成果**: 生成高品質、結構化的實施計劃文檔，為任務執行提供完整指導
</phase>

</optimization_phases>

## 錯誤處理與品質保證

<quality_assurance>

### 錯誤處理機制
<error_handling>
- **檔案存取錯誤**: 無法讀取指定路徑的檔案時，記錄錯誤並提供替代方案
- **格式解析錯誤**: 檔案格式不符合預期時，進行錯誤報告並嘗試修復
- **內容驗證失敗**: 規劃內容不完整時，標記缺失項目並要求補充
- **輸出路徑錯誤**: 目標路徑不存在時，自動建立目錄結構
</error_handling>

### 驗證標準
<validation_criteria>
- [ ] **完整性驗證**: 所有必要的專案規範和架構文檔已載入分析
- [ ] **準確性驗證**: 任務解析結果與原始需求一致
- [ ] **結構性驗證**: 生成的計劃符合模板規範和格式要求
- [ ] **可執行性驗證**: 計劃內容具體、明確且可操作
- [ ] **追溯性驗證**: 計劃元素與來源需求間具有清晰的對應關係
- [ ] **一致性驗證**: 術語使用和風格保持統一
</validation_criteria>

</quality_assurance>

## 輸出格式規範

<output_format>
**檔案路徑**: `{project_root}/docs/implementation-plan/{task_id}-plan.md`

**檔案命名範例**:
- 主任務 1: `1-plan.md`
- 主任務 2: `2-plan.md`
- 主任務 3: `3-plan.md`

**內容結構**: 嚴格遵循 `implementation-plan-tmpl.yaml` 模板規範，確保所有必填欄位完整填寫，避免使用「視需要」或「待確定」等通用陳述。
</output_format>