# Knowledge Curator 強制執行規範

## 核心執行協議

### 必要前置條件（寬鬆）
- **建議**：開始前載入統一工作流程、模板與來源文件；若缺失，記錄至 validation_warnings 並持續
- **工作流程讀取**：應讀取 `{project_root}/cursor-claude/core/po/workflow/unified-knowledge-curation-workflow.yaml`，失敗則記錄警告
- **模板讀取**：應讀取 `{project_root}/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml`，失敗則記錄警告
- **來源掃描**：應掃描指定路徑的審查報告和完成報告；缺失則記錄警告並以現有資訊繼續

### 工作流程合規性（強制執行）
- **階段完整性**：必須按照 unified-knowledge-curation-workflow.yaml 定義的所有階段順序執行
- **Platinum級別篩選**：必須嚴格執行 platinum_practices 驗證規則（min_score=4.0, required_maturity="platinum"）
- **三層知識架構**：必須建立急診清單、詳細分析、預防指南的完整架構
- **並行執行**：在來源發現階段必須並行掃描審查報告和完成報告
- **模式分析**：必須執行錯誤模式識別與成功實踐關聯分析
- **品質驗證**：必須執行證據完整性和platinum標準的最終驗證

### 來源資料品質（強制驗證）
- **審查報告**：必須從 `{{project_root}}/docs/implementation-review/*.md` 提取 `error_log` 與 `findings`
- **完成報告**：必須從 `{{project_root}}/docs/completion-reports/*-completion.md` 提取品質評估資料
- **證據鏈結**：每個知識條目都必須有具體的證據支持（檔案路徑、行號、PR鏈結）
- **來源可追溯**：必須能追溯每個最佳實踐和錯誤模式的原始來源

### 錯誤模式分析（強制執行）
- **模式識別**：必須識別重複出現的錯誤模式和共同根因
- **嚴重性分級**：必須按 blocker > high > medium > low 分級錯誤
- **可復現性評估**：必須評估錯誤的可復現性和影響範圍
- **傳播分析**：必須分析錯誤在不同團隊/專案間的傳播模式

### 最佳實踐萃取（強制要求）
- **品質門檻**：僅收錄 quality_assessment.summary_score ≥ 4 或被QA正面評價的實踐
- **實證基礎**：每個最佳實踐都必須有實際成功案例支持
- **適用性分析**：必須明確標註適用和不適用的情境
- **可檢核清單**：必須提供具體的檢核步驟和驗證方法

### 知識結構化（強制標準）
- **分層架構**：必須建立快速對照表、詳細分析、預防指南的三層結構
- **交叉鏈結**：相關的最佳實踐與錯誤模式必須互相鏈結形成閉環
- **編碼系統**：錯誤代碼必須遵循 ERR-[領域]-[編號] 格式
- **版本控制**：必須記錄知識庫的版本和更新歷史

### 修復方案驗證（絕對強制）
- **實證分離**：必須將「已驗證修復」與「建議步驟」明確分開標示
- **成功案例**：已驗證修復必須有具體的PR或commit證據
- **驗證步驟**：必須提供驗證修復成功的具體步驟
- **失敗率統計**：必須記錄修復方案的成功率和失敗案例

### 預防機制設計（強制實施）
- **根因分析**：必須追溯到錯誤的根本原因而非表面現象
- **預防策略**：必須為每個錯誤模式提供預防措施
- **檢測機制**：必須設計早期檢測和預警機制
- **工具支持**：必須推薦或建立支持預防的工具和流程

### 快速響應設計（強制優化）
- **急診清單**：必須建立可在5分鐘內查找的快速對照表
- **關鍵詞索引**：必須建立基於錯誤現象的關鍵詞索引
- **相似性搜索**：必須支持基於錯誤描述的相似性匹配
- **優先級排序**：必須按影響和緊急程度排序錯誤處理順序

### 社群智慧整合（強制促進）
- **多團隊視角**：必須整合來自不同團隊的經驗和視角
- **知識共享**：必須建立知識貢獻和共享的機制
- **專家網路**：必須建立領域專家的聯繫網路
- **集體學習**：必須促進團隊集體學習和經驗交流

### 持續進化機制（強制建立）
- **定期更新**：必須建立定期更新知識庫的機制
- **過時清理**：必須定期清理過時和無效的資訊
- **新模式發現**：必須持續發現和記錄新的錯誤模式
- **效果追蹤**：必須追蹤知識庫使用效果和改進空間

### 模板合規性（強制執行）
- **結構一致性**：必須遵循 `{project_root}/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml` 結構
- **內容完整性**：所有必需部分都必須有實際內容或標記為 "N/A - [原因]"
- **佔位符清除**：不得有未填充的 `<placeholder>` 值
- **格式標準化**：必須符合統一的格式和命名規範

### Markdown格式轉換（絕對強制）
- **YAML到Markdown**：必須將 `knowledge-lessons-tmpl.yaml` 結構完整轉換為標準Markdown格式
- **標題層級**：YAML section轉換為對應的Markdown標題（# ## ### #### ##### ######）
- **清單格式**：YAML陣列轉換為Markdown清單（- 或 1. 格式）
- **代碼區塊**：錯誤代碼、修復步驟、驗證命令使用標準Markdown代碼塊（```language）
- **表格格式**：快速對照表、錯誤模式清單使用Markdown表格格式 | 欄位 | 值 |
- **鏈結格式**：證據連結、PR參考使用標準Markdown鏈結格式 [文字](URL)
- **區塊引用**：重要提醒、警告訊息使用 > 引用格式
- **強調標記**：使用 **粗體** 和 *斜體* 適當強調關鍵知識點和風險
- **分類標示**：使用表情符號清楚標示內容類型（🚨 常見錯誤、✅ 已驗證修復、💡 最佳實踐、⚠️ 預防措施）
- **複雜度指標**：使用星級或顏色標示知識條目的複雜度和重要性

### 品質保證要求（強制達標）
- **客觀性**：所有分析都必須基於可驗證的事實和數據
- **準確性**：所有修復方案都必須經過驗證或明確標註為建議
- **實用性**：所有知識條目都必須對實際工作有明確價值
- **時效性**：所有資訊都必須反映當前的技術環境和實踐

### 影響測量（強制追蹤）
- **使用統計**：必須追蹤知識庫的使用頻率和方式
- **效果評估**：必須評估知識庫對錯誤減少的實際效果
- **時間節省**：必須測量知識庫對問題解決時間的改善
- **學習曲線**：必須追蹤對新人學習曲線的改善效果

### 安全要求（強制遵守）
- **只讀保護**：絕不修改 `docs/specs/` 中的任何檔案
- **敏感資訊**：避免在知識庫中暴露敏感的系統資訊
- **訪問控制**：確保只處理授權範圍內的檔案和資料
- **資料隱私**：保護個人和專案敏感資訊

### 輸出位置（固定）
- **主文檔**：`{{project_root}}/docs/knowledge/engineering-lessons.md`
- **模板參考**：`{project_root}/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml`
- **備份路徑**：`{{project_root}}/docs/knowledge/engineering-lessons-{{timestamp}}.md`
- **索引文件**：`{{project_root}}/docs/knowledge/index.md`

## 知識策展檢查清單（強制執行）

### 來源分析檢查
- [ ] 審查報告已掃描且error_log提取完成
- [ ] 完成報告已分析且品質評估數據提取完成
- [ ] 所有知識條目都有明確的證據鏈結
- [ ] 來源可追溯性已建立

### 錯誤模式分析檢查
- [ ] 重複錯誤模式已識別並分類
- [ ] 嚴重性分級準確且有依據
- [ ] 根因分析深入且準確
- [ ] 傳播模式分析完整

### 最佳實踐檢查
- [ ] 僅收錄高品質實踐（score ≥ 4）
- [ ] 每個實踐都有實證基礎
- [ ] 適用性分析明確
- [ ] 檢核清單具體可操作

### 知識結構檢查
- [ ] 三層結構（急診-治療-預防）已建立
- [ ] 交叉鏈結網路已形成
- [ ] 編碼系統一致
- [ ] 快速對照表可用

### 修復方案檢查
- [ ] 已驗證修復與建議步驟明確分離
- [ ] 所有已驗證修復都有證據支持
- [ ] 驗證步驟具體可執行
- [ ] 成功率數據準確

### 預防機制檢查
- [ ] 根因分析深入準確
- [ ] 預防策略具體可行
- [ ] 檢測機制設計完整
- [ ] 工具推薦實用

## 品質門檻（強制通過）
- **Platinum級別篩選**：只記錄 implementation_maturity >= 'platinum' 或 quality_assessment.summary_score >= 4 的實踐
- **證據支持率**：100%的知識條目都必須有具體證據（檔案路徑、PR連結、測試報告）
- **實證比例**：至少70%的修復方案必須是已驗證的
- **三層架構完整性**：急診清單、詳細分析、預防指南三層必須完整建立
- **成功率門檻**：納入的實踐必須有 >= 0.8 的成功率
- **更新頻率**：知識庫必須每季度更新一次
- **使用效果**：必須能證明對錯誤減少的實際效果

## 失敗處理協議（記錄並續行）
- **來源文件缺失**：記錄缺失路徑與替代資訊來源；繼續處理現有資料
- **證據鏈結不足**：記錄缺失證據與補充計劃；標註為建議級別
- **模式識別失敗**：記錄分析困難與人工介入需求；不中斷處理
- **模板不合規**：記錄差異與修正計劃；不中斷輸出
- **品質門檻未達**：記錄差距與改進計劃；安排後續增強
