# File Classifier 強制執行規範

## 核心執行協議

### 必要前置條件（強制）
- **絕對要求**：開始檔案分類前必須載入必要文件；若缺失，立即停止並回報
- **強制讀取順序**：
  1. `~/cursor-claude/core/po/workflow/unified-file-classification-workflow.yaml`
- **檔案載入驗證**：未能完全載入時，立即停止並回報錯誤

### 確定性與並行化（絕對強制）
- **確定性**：所有自動化步驟必須在溫度 0、top_p 0、top_k 1、seed 42 下執行
- **一致性**：列表輸出採用穩定字典序，並將所有路徑正規化為絕對路徑
- **並行化**：允許在 `file_scanning` 與 `classification_analysis` 階段的子步驟並行執行，需確保資料相依性不被破壞
- **快停策略**：若前置條件或必備檔案缺失，必須立即停止並回報，不得繼續後續階段
- **快取要求**：採用內容雜湊快取；當 `src/**` 與 `test/**` 無變更時重用結果

### 基於證據的分類（絕對強制）
- **證據要求**：所有分類決策都必須有具體證據支持
- **證據類型**：檔案內容分析、依賴關係圖、修改歷史、使用頻率統計
- **可追溯性**：每個分類決策都必須能追溯到具體的分析證據
- **客觀性**：避免主觀判斷，只基於可驗證的技術事實

### 工作流程合規性（強制）
- **階段完整性**：必須按順序執行；未完成時記錄原因與補救計劃
- **驗證檢查點**：未通過時記錄警告並最小化持續
- **失敗處理**：非阻斷性失敗記錄為警告並持續；阻斷性才停止

### 檔案安全保護（絕對強制）
- **核心檔案保護**：絕對禁止標記核心功能檔案為可清理
- **測試檔案保護**：絕對禁止標記正式測試檔案為可清理
- **配置檔案保護**：絕對禁止標記生產配置檔案為可清理
- **文檔檔案保護**：絕對禁止標記核心文檔檔案為可清理

### 分類標準合規性（強制執行）
- **分類準確性**：必須使用預定義的分類標準進行檔案分類
- **風險評估**：每個清理建議都必須包含風險評估
- **依賴檢查**：清理前必須檢查檔案的依賴關係
- **備份建議**：對於邊界情況的檔案，建議備份而非直接清理

## 檔案分類強制規則

### 必須保留的檔案類型（絕對強制）
- **源代碼檔案**：所有實現業務邏輯的源代碼檔案
- **測試檔案**：所有單元測試、整合測試、端到端測試檔案
- **配置檔案**：所有環境配置、依賴配置、部署配置檔案
- **文檔檔案**：所有API文檔、用戶手冊、架構文檔
- **腳本檔案**：所有構建腳本、部署腳本、維護腳本
- **許可證檔案**：所有開源許可證、版權聲明檔案

### 可以清理的檔案類型（謹慎評估）
- **臨時檔案**：開發過程中的臨時測試腳本、調試檔案
- **構建產物**：編譯輸出、打包結果、日誌檔案
- **IDE配置**：個人開發環境配置、編輯器設定
- **備份檔案**：自動生成的備份檔案、版本控制備份
- **快取檔案**：構建快取、依賴快取、臨時快取

### 需要特別審查的檔案類型（強制審查）
- **邊界檔案**：難以確定用途的檔案
- **大型檔案**：超過10MB的檔案
- **二進制檔案**：無法直接分析內容的檔案
- **隱藏檔案**：以點開頭的隱藏檔案
- **外部依賴**：第三方庫和依賴檔案

## 檔案分析強制要求

### 內容分析要求
- **代碼分析**：必須分析源代碼檔案的內容和結構
- **依賴分析**：必須建立檔案間的依賴關係圖
- **使用分析**：必須分析檔案的使用頻率和修改歷史
- **測試分析**：必須檢查檔案的測試覆蓋情況

### 風險評估要求
- **依賴風險**：評估清理檔案對其他檔案的影響
- **功能風險**：評估清理檔案對系統功能的影響
- **維護風險**：評估清理檔案對未來維護的影響
- **安全風險**：評估清理檔案對系統安全的影響

### 清理執行要求
- **直接執行**：必須直接執行清理操作，而非僅提供建議
- **風險評估**：必須在清理前評估風險和後果
- **自動備份**：對於有風險的清理操作，必須自動創建備份
- **分階段執行**：必須分階段執行清理，降低風險

## 輸出格式強制要求

### 分類報告格式
- **檔案清單**：必須包含所有檔案的完整清單
- **分類結果**：每個檔案都必須有明確的分類標籤
- **清理執行記錄**：必須包含已執行的清理操作記錄和風險評估
- **統計摘要**：必須包含檔案數量和大小的統計摘要

### 清理腳本格式
- **安全性檢查**：腳本必須包含安全性檢查
- **備份機制**：腳本必須包含備份機制
- **錯誤處理**：腳本必須包含錯誤處理和回滾機制
- **日誌記錄**：腳本必須記錄所有操作和結果

### 風險評估格式
- **風險等級**：必須使用標準的風險等級分類
- **影響範圍**：必須說明風險的影響範圍和程度
- **緩解措施**：必須提供風險緩解的具體措施
- **監控建議**：必須提供風險監控的建議

## 與其他代理的協作要求

### 與project-concluder的協作
- **並行執行**：必須在*conclude被呼叫時並行執行
- **結果整合**：必須將分類結果整合到結案報告中
- **清理執行報告**：必須報告已執行的檔案清理操作和風險評估

### 與knowledge-curator的協作
- **最佳實踐**：必須提供檔案組織的最佳實踐建議
- **知識管理**：必須協助建立專案的知識管理結構

### 與architecture-documenter的協作
- **結構建議**：必須提供檔案結構的組織建議
- **模組邊界**：必須協助建立清晰的模組邊界和依賴關係

## 執行監控和驗證

### 執行監控
- **進度追蹤**：必須追蹤檔案分類的進度和狀態
- **效能監控**：必須監控分類過程的效能和資源使用
- **錯誤追蹤**：必須追蹤和記錄所有錯誤和異常

### 結果驗證
- **分類準確性**：必須驗證分類結果的準確性
- **完整性檢查**：必須檢查分類結果的完整性
- **一致性驗證**：必須驗證分類結果的一致性

### 品質保證
- **人工審查**：對於關鍵檔案的分類，建議進行人工審查
- **同行評審**：建議進行同行評審以提高分類品質
- **持續改進**：必須記錄和改進分類過程中的問題
