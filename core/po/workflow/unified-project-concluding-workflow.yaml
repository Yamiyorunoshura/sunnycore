---
template: unified-project-concluding-workflow
version: 1

# ğŸ”„ å·¥ä½œæµç¨‹Todo Listè£½ä½œæµç¨‹
todo_list_creation:
  description: "åœ¨é–‹å§‹åŸ·è¡Œä»»ä½•å·¥ä½œæµç¨‹æ­¥é©Ÿä¹‹å‰ï¼Œå¿…é ˆä½¿ç”¨todo_writeå·¥å…·å‰µå»ºåŒ…å«æ‰€æœ‰workflowæ­¥é©Ÿçš„todo list"
  importance: "critical"
  
  # ğŸ› ï¸ Todo Listå·¥å…·ä½¿ç”¨æŒ‡å—
  tool_syntax:
    format: "JSON"
    structure: |
      {
        "todos": [
          {
            "content": "å…·é«”ä»»å‹™æè¿°",
            "status": "pending|in_progress|completed",
            "id": "å”¯ä¸€è­˜åˆ¥ç¢¼",
            "priority": "high|medium|low"
          }
        ]
      }
  
  process_steps:
    1_analyze_workflow:
      description: "åˆ†æå·¥ä½œæµç¨‹çµæ§‹ - ä»”ç´°é–±è®€æ•´å€‹workflowæ–‡ä»¶ï¼Œè­˜åˆ¥æ‰€æœ‰éšæ®µã€æ­¥é©Ÿå’Œä»»å‹™"
      priority: "high"
      
    2_extract_tasks:
      description: "æå–é—œéµä»»å‹™ - å°‡æ¯å€‹éšæ®µçš„æ ¸å¿ƒä»»å‹™è½‰æ›ç‚ºå…·é«”çš„todoé …ç›®"
      priority: "high"
      
    3_set_priorities:
      description: "è¨­å®šå„ªå…ˆç´š - æ ¹æ“šä»»å‹™çš„é‡è¦æ€§å’Œä¾è³´é—œä¿‚è¨­å®šå„ªå…ˆç´š"
      priority: "medium"
      
    4_create_todo_list:
      description: "å‰µå»ºTodo List - ä½¿ç”¨todo_writeå·¥å…·å‰µå»ºåŒ…å«æ‰€æœ‰æ­¥é©Ÿçš„çµæ§‹åŒ–todo list"
      priority: "high"
      
    5_execute_workflow:
      description: "åŸ·è¡Œèˆ‡æ›´æ–° - æŒ‰ç…§todo listé †åºåŸ·è¡Œä»»å‹™ï¼ŒåŠæ™‚æ›´æ–°ç‹€æ…‹"
      priority: "high"
  
  # ğŸ“ Todo Listè¦æ±‚
  requirements:
    coverage: "æ¯å€‹ä¸»è¦éšæ®µéƒ½æ‡‰è©²æœ‰å°æ‡‰çš„todoé …ç›®"
    validation: "é—œéµçš„é©—è­‰æª¢æŸ¥é»å¿…é ˆåŒ…å«åœ¨todo listä¸­"
    priority_setting: "è¨­å®šåˆç†çš„å„ªå…ˆç´šï¼Œç¢ºä¿ä¾è³´é—œä¿‚å¾—åˆ°å°Šé‡"
    status_tracking: "åœ¨åŸ·è¡Œéç¨‹ä¸­åŠæ™‚æ›´æ–°todoç‹€æ…‹ï¼ˆpending â†’ in_progress â†’ completedï¼‰"
    uniqueness: "åŒæ™‚åªèƒ½æœ‰ä¸€å€‹ä»»å‹™è™•æ–¼in_progressç‹€æ…‹"
    completeness: "åªæœ‰åœ¨ä»»å‹™å®Œå…¨å®Œæˆæ™‚æ‰æ¨™è¨˜ç‚ºcompleted"

# åˆ†éš”ç·šï¼Œä»¥ä¸‹ç‚ºåŸå§‹workflowå…§å®¹
---

workflow:
  name: "çµ±ä¸€å°ˆæ¡ˆçµæ¡ˆå·¥ä½œæµç¨‹"
  description: "æ”¶é›†äº¤ä»˜è­‰æ“šã€QAæ½›åœ¨å•é¡Œå’Œæœªä¾†å¢å¼·çš„çµ±ä¸€çµæ¡ˆå·¥ä½œæµç¨‹ï¼Œç”Ÿæˆå®Œæ•´çš„å®Œæˆå ±å‘Šã€‚"
  report_template: "~/cursor-claude/core/po/templates/completion-report-tmpl.yaml"
  enforcement_level: "lenient"
  halt_on_validation_failure: false

inputs:
  task_id: "<required>"
  project_root: "<auto>"

execution_hints:
  determinism:
    temperature: 0
    top_p: 1
    seed: 42
    response_variability: "minimal"
  parallelization:
    enabled: true
    max_concurrency: 5
    in_stages:
      evidence_collection:
        - "read_specification_files"
        - "resolve_plan_by_task_id"
        - "gather_implementation_evidence"
        - "gather_quality_artifacts"
        - "gather_qa_reviews_and_feedback"
      delivery_synthesis:
        - "map_delivery_to_original_scope"
        - "analyze_acceptance_criteria_achievement"
        - "document_completion_deferred_outofscope_items"
        - "cross_reference_with_test_evidence"
      documentation_update:
        - "load_readme_template"
        - "load_changelog_template"
        - "update_readme_from_template"
        - "append_changelog_entry"
      knowledge_and_architecture:
        - "run_knowledge_curator"
        - "run_architecture_documenter"
        - "run_file_classifier"
  caching:
    enabled: true
    strategy: "content_hash"
    key_paths:
      - "{{project_root}}/docs/specs/**/*"
      - "{{project_root}}/docs/implementation-plan/**/*"
    expire_on_changes: true
  ordering:
    list_sorting: "stable_lexicographic"
    normalize_paths: true

path_aliases:
  WORKFLOW_FILE: "~/cursor-claude/core/po/workflow/unified-project-concluding-workflow.yaml"
  REPORT_TEMPLATE: "~/cursor-claude/core/po/templates/completion-report-tmpl.yaml"
  ENFORCEMENT_FILE: "~/cursor-claude/core/po/enforcement/project-concluder-enforcement.md"

plan_resolution:
  find_by_task_id: true
  search_paths:
    - "{{project_root}}/docs/implementation-plan"
  supported_extensions: ["yaml", "yml", "md"]
  expectations:
    template: "implementation-plan"
    version: 1

guardrails:
  evidence_is_blocking: false
  on_missing_evidence: "append_warning_and_continue_as_limitation"
  halt_on_preconditions_failure: false

preconditions:
  - "æ‰€æœ‰ä»»å‹™å·²é€šéQAå¯©æŸ¥ï¼ˆæª¢æŸ¥task.mdä¸­æ‰€æœ‰é …ç›®æ¨™è¨˜ç‚º[x]ï¼‰"
  - "å¯¦æ–½è¨ˆåŠƒæ–‡ä»¶å­˜åœ¨ä¸”å¯è¿½è¹¤"
  - "QA å›é¥‹å·²æ”¶é›†æˆ–ç¢ºèªä¸å¯ç²å¾—"
  
task_completion_check:
  description: "åœ¨é–‹å§‹çµæ¡ˆå‰é©—è­‰æ‰€æœ‰ä»»å‹™å·²å®Œæˆ"
  check_method:
    - "è®€å– docs/specs/task.md"
    - "æƒææ‰€æœ‰ä»»å‹™é …ç›®çš„ç‹€æ…‹æ¨™è¨˜"
    - "ç¢ºèªæ²’æœ‰ [ ] æˆ– [-] ç‹€æ…‹çš„é …ç›®"
    - "åªæœ‰æ‰€æœ‰é …ç›®éƒ½æ˜¯ [x] ç‹€æ…‹æ‰å…è¨±ç¹¼çºŒ"
  on_incomplete_tasks:
    action: "halt_and_report_incomplete_tasks"
    message: "ç™¼ç¾æœªå®Œæˆä»»å‹™ï¼Œç„¡æ³•åŸ·è¡Œçµæ¡ˆã€‚è«‹å…ˆå®Œæˆæ‰€æœ‰ä»»å‹™çš„é–‹ç™¼å’Œå¯©æŸ¥ã€‚"

# æ•´åˆçš„åŸ·è¡Œå”è­°
enforcement_protocol:
  enforcement_compliance:
    mandatory_enforcement_file: "~/cursor-claude/core/po/enforcement/project-concluder-enforcement.md"
    compliance_verification: "Verify enforcement rules are understood; record warnings on minor non-compliance and continue"
    halt_on_non_compliance: false
  
  mandatory_file_loading:
    description: "åœ¨é–‹å§‹ä»»ä½•çµæ¡ˆå·¥ä½œä¹‹å‰å¿…é ˆè¼‰å…¥çš„æª”æ¡ˆ"
    requirements:
      - "READ ~/cursor-claude/core/po/enforcement/project-concluder-enforcement.md COMPLETELY - This file contains all mandatory rules and constraints"
      - "READ çµ±ä¸€å°ˆæ¡ˆçµæ¡ˆå·¥ä½œæµç¨‹ YAML æª”æ¡ˆå®Œæ•´å…§å®¹"
      - "READ å®Œæˆå ±å‘Šç¯„æœ¬ YAML æª”æ¡ˆå®Œæ•´å…§å®¹"
      - "ç¢ºèªç†è§£æ‰€æœ‰å·¥ä½œæµç¨‹éšæ®µ"
      - "ç¢ºèªç†è§£ç¯„æœ¬çµæ§‹"
      - "ç¢ºèªç†è§£é©—è­‰éœ€æ±‚"
      - "å¦‚æœä»»ä½•æª”æ¡ˆç„¡æ³•è¼‰å…¥æˆ–ç†è§£å‰‡åœæ­¢"

  evidence_collection_requirements:
    specification_files:
      - "docs/specs/task.md - ä»»å‹™è¦æ ¼"
      - "docs/specs/requirements.md - éœ€æ±‚è¦æ ¼"
      - "docs/specs/design.md - è¨­è¨ˆè¦æ ¼"
    
    implementation_plan:
      - "æ ¹æ“š task_id åœ¨ docs/implementation-plan/ ä¸­å®šä½è¨ˆåŠƒ"
      - "å®Œæ•´è®€å–è¨ˆåŠƒæ–‡ä»¶"
      - "é©—è­‰è¨ˆåŠƒå­˜åœ¨ä¸”ç¬¦åˆé æœŸç¯„æœ¬"
    
    implementation_evidence:
      - "PRs: æ”¶é›†PRé€£çµå’Œæè¿°"
      - "Commits: è¨˜éŒ„ç›¸é—œæäº¤é›œæ¹Šå’Œè¨Šæ¯"
      - "Changed Files: åˆ—å‡ºä¿®æ”¹æª”æ¡ˆåŠå…¶ç”¨é€”"
      - "Migrations: è¨˜éŒ„è³‡æ–™åº«/æ¶æ§‹è®Šæ›´"
      - "Configurations: è¨˜éŒ„ç’°å¢ƒ/é…ç½®è®Šæ›´"
    
    quality_artifacts:
      - "Test Reports: æ”¶é›†å–®å…ƒã€æ•´åˆã€é©—æ”¶æ¸¬è©¦çµæœ"
      - "Coverage: è¨˜éŒ„å¯¦éš›æ¶µè“‹ç‡ç™¾åˆ†æ¯”"
      - "CI Status: åŒ…å«å»ºç½®å’Œéƒ¨ç½²ç‹€æ…‹"
      - "Performance: æ”¶é›†å¯¦éš›æ•ˆèƒ½æ¸¬é‡çµæœ"
      - "Security Scans: åŒ…å«å®‰å…¨åˆ†æçµæœ"
    
    qa_reviews:
      - "QA Feedback: æ”¶é›†QAå¯©æŸ¥è©•è«–å’Œå•é¡Œ"
      - "Issue Status: è¨˜éŒ„ç•¶å‰è™•ç†ç‹€æ…‹"
      - "Resolution Plans: è¨˜éŒ„è¨ˆåŠƒä¿®å¾©å’Œæ”¹é€²"
    
    project_md_documents:
      - "æƒææ•´å€‹å°ˆæ¡ˆç›®éŒ„çµæ§‹ï¼Œæ”¶é›†æ‰€æœ‰ .md æ–‡æª”"
      - "åˆ†ææ–‡æª”å…§å®¹ï¼Œæå–ç›¸é—œè³‡è¨Šå’Œè¦‹è§£"
      - "è­˜åˆ¥æ–‡æª”ä¹‹é–“çš„é—œè¯æ€§å’Œä¾è³´é—œä¿‚"
      - "è¨˜éŒ„æ–‡æª”çš„å®Œæ•´æ€§å’Œå“è³ªç‹€æ…‹"
      - "ç‚º completion report æä¾›å…¨é¢çš„æ–‡æª”åˆ†æåŸºç¤"

  stage_execution_checkpoints:
    before_stage:
      - "èªªæ˜æ­£åœ¨é–‹å§‹çš„éšæ®µ"
      - "åƒè€ƒå·¥ä½œæµç¨‹æª”æ¡ˆä¸­çš„ç‰¹å®šéšæ®µéœ€æ±‚"
    
    during_stage:
      - "åŸ·è¡Œè©²éšæ®µåˆ—å‡ºçš„æ‰€æœ‰å‹•ä½œ"
      - "é€²è¡Œç³»çµ±æ€§åˆ†æå’Œè©•ä¼°"
      - "æ”¶é›†æ‰€æœ‰å¿…éœ€çš„è­‰æ“š"
    
    after_stage:
      - "å°ç…§é©—è­‰è¦å‰‡é©—è­‰éšæ®µå®Œæˆ"
      - "ç¢ºèªæ‰€æœ‰å¿…éœ€çš„è¼¸å‡ºå·²ç”Ÿæˆ"
      - "ç”¨è­‰æ“šé€£çµè¨˜éŒ„ç™¼ç¾"

  synthesis_requirements:
    delivery_mapping:
      - "äº¤å‰åƒè€ƒå·²å®Œæˆçš„äº¤ä»˜æˆæœèˆ‡åŸå§‹ç¯„åœ"
      - "è¨˜éŒ„æ¯å€‹è¨ˆåŠƒé …ç›®çš„å®Œæˆç‹€æ…‹"
      - "è­˜åˆ¥ä»»ä½•å»¶æœŸæˆ–ç¯„åœå¤–è®Šæ›´"
      - "ç‚ºæ‰€æœ‰å®Œæˆè²æ˜æä¾›è­‰æ“š"
    
    acceptance_criteria_analysis:
      - "æ¯”è¼ƒå¯¦æ–½åŠŸèƒ½èˆ‡é©—æ”¶æ¨™æº–"
      - "åƒè€ƒæ¸¬è©¦çµæœå’Œé©—è­‰è­‰æ“š"
      - "è¨˜éŒ„ä»»ä½•æœªæ»¿è¶³æˆ–éƒ¨åˆ†æ»¿è¶³çš„æ¨™æº–"
      - "é€£çµåˆ°å…·é«”æ¸¬è©¦å ±å‘Šæˆ–é©—è­‰å·¥ä»¶"
    
    qa_problem_extraction:
      - "ç¸½çµQAå›é¥‹å’Œé—œæ³¨é»"
      - "æŒ‰åš´é‡æ€§å’Œç•¶å‰ç‹€æ…‹åˆ†é¡"
      - "è¨˜éŒ„è§£æ±ºè¨ˆåŠƒå’Œæ™‚é–“ç·š"
      - "è¿½è¹¤æŒçºŒå•é¡Œå’Œæ¬Šå®œä¹‹è¨ˆ"
    
    known_issues_documentation:
      - "åˆ—å‡ºç•¶å‰ç¼ºé™·å’Œé™åˆ¶"
      - "æè¿°æŠ€è¡“å‚µå‹™å’Œæ‰€åšæ¬Šè¡¡"
      - "è¨˜éŒ„ç¾æœ‰çš„è‡¨æ™‚è§£æ±ºæ–¹æ¡ˆ"
      - "è©•ä¼°é¢¨éšªç­‰ç´šå’Œå½±éŸ¿"
    
    project_documentation_analysis:
      - "ç¶œåˆåˆ†ææ‰€æœ‰æ”¶é›†çš„å°ˆæ¡ˆæ–‡æª”"
      - "è­˜åˆ¥æ–‡æª”è¦†è“‹ç¯„åœçš„ç¼ºå£å’Œé‡è¤‡"
      - "è©•ä¼°æ–‡æª”å“è³ªã€ä¸€è‡´æ€§å’Œå¯ç¶­è­·æ€§"
      - "è¨˜éŒ„æ–‡æª”æ¶æ§‹çš„å„ªé»å’Œæ”¹é€²æ©Ÿæœƒ"
      - "ç‚ºæœªä¾†æ–‡æª”æ”¹é€²æä¾›å…·é«”å»ºè­°"

  enhancement_planning:
    gap_based_enhancements:
      - "å¾ä¸å®Œæ•´åŠŸèƒ½ä¸­è­˜åˆ¥æ©Ÿæœƒ"
      - "å¾QAå›é¥‹ä¸­è¡ç”Ÿæ”¹é€²"
      - "è€ƒæ…®æ•ˆèƒ½æœ€ä½³åŒ–æ©Ÿæœƒ"
      - "è©•ä¼°å¯ç¶­è­·æ€§æ”¹é€²"
    
    success_criteria_definition:
      - "ç‚ºæ¯å€‹å¢å¼·å®šç¾©å¯æ¸¬é‡çš„æˆåŠŸæ¨™æº–"
      - "è¨­å®šç¾å¯¦çš„æ™‚é–“ç·šå’ŒåŠªåŠ›ä¼°è¨ˆ"
      - "è­˜åˆ¥ä¾è³´é—œä¿‚å’Œå…ˆæ±ºæ¢ä»¶"
      - "æŒ‰æ¥­å‹™åƒ¹å€¼å’ŒæŠ€è¡“å½±éŸ¿æ’å„ªå…ˆç´š"

  template_population_enforcement:
    mandatory_steps:
      - "ç¸½æ˜¯å…ˆè®€å–ç¯„æœ¬æª”æ¡ˆå†å¯«å…¥"
      - "æŒ‰ç¯„æœ¬éœ€æ±‚é€ç« ç¯€å¡«å……"
      - "çµ•ä¸ç•™ä¸‹ä½”ä½ç¬¦æ–‡æœ¬å¦‚ {task_id}`(å¦‚`1`, `2`, `3`...) æˆ– INSERT VALUE"
      - "æ¯å€‹å®Œæˆè²æ˜éƒ½å¿…é ˆåŒ…å«å…·é«”è­‰æ“š"
      - "åŒ…å«å¯¦éš›æ¸¬é‡çµæœï¼Œéä¼°è¨ˆ"
      - "å®Œæ•´æ€§æª¢æŸ¥ï¼šæ¯å€‹ç¯„æœ¬ç« ç¯€éƒ½å¿…é ˆå¡«å……"

  validation_checkpoints:
    after_document_generation:
      - "é‡æ–°è®€å–ç”Ÿæˆçš„æ–‡ä»¶"
      - "é€ç« ç¯€èˆ‡ç¯„æœ¬çµæ§‹æ¯”è¼ƒ"
      - "é©—è­‰æ²’æœ‰ä½”ä½ç¬¦å€¼æ®˜ç•™"
      - "ç¢ºèªæ‰€æœ‰å®Œæˆè²æ˜éƒ½æœ‰è­‰æ“šæ”¯æŒ"
      - "é©—è­‰markdownæ ¼å¼å’Œçµæ§‹"
    
    completion_criteria:
      - "æ‰€æœ‰å·¥ä½œæµç¨‹éšæ®µå·²å®Œæˆ"
      - "æ‰€æœ‰ç¯„æœ¬ç« ç¯€ç”¨å¯¦éš›å…§å®¹å¡«å……"
      - "æ‰€æœ‰é©—è­‰è¦å‰‡å·²æ»¿è¶³"
      - "æ‰€æœ‰å®Œæˆè²æ˜æœ‰è­‰æ“šæ”¯æŒ"
      - "QAæ½›åœ¨å•é¡Œå·²åˆ†æå’Œè¨˜éŒ„"
      - "æœªä¾†å¢å¼·å…·é«”ä¸”æœ‰å„ªå…ˆç´š"
      - "æ–‡ä»¶æº–å‚™å¥½äº¤æ¥çµ¦åˆ©å®³é—œä¿‚äºº"

  error_handling:
    validation_failures:
      - "å¦‚æœé©—è­‰å¤±æ•—ç«‹å³åœæ­¢"
      - "è­˜åˆ¥å…·é«”é©—è­‰å¤±æ•—"
      - "è¿”å›é©ç•¶çš„å·¥ä½œæµç¨‹éšæ®µ"
      - "ä¿®æ­£å¾Œé‡æ–°åŸ·è¡Œ"
      - "ç¹¼çºŒå‰é‡æ–°é©—è­‰"
    
    evidence_collection_failures:
      - "å¦‚æœè­‰æ“šç¼ºå¤±ï¼Œè¨˜éŒ„ç‚ºé™åˆ¶"
      - "å¦‚æœQAå¯©æŸ¥ä¸å¯ç²å¾—ï¼Œè¨˜éŒ„ç¼ºå¤±"
      - "å¦‚æœæ•ˆèƒ½è³‡æ–™ä¸å®Œæ•´ï¼Œæ”¶é›†å¯ç²å¾—æŒ‡æ¨™"
      - "å¦‚æœæ¸¬è©¦ä¸è¶³ï¼Œè¨˜éŒ„æ¶µè“‹ç‡ç¼ºå£"

  critical_success_factors:
    - "å…ˆè®€å–å·¥ä½œæµç¨‹å’Œç¯„æœ¬æª”æ¡ˆ - çµ•ä¸åœ¨æ²’æœ‰å®ƒå€‘çš„æƒ…æ³ä¸‹é–‹å§‹"
    - "æ”¶é›†å…¨é¢è­‰æ“š - PRsã€æäº¤ã€æ¸¬è©¦ã€QAå›é¥‹"
    - "ç³»çµ±æ€§åˆ†æ - å…ˆå®šç¾©çµæ¡ˆç­–ç•¥"
    - "å°‡äº¤ä»˜æ˜ å°„åˆ°åŸå§‹ç¯„åœ - æ¸…æ™°çš„å®Œæˆç‹€æ…‹"
    - "åˆ†æé©—æ”¶æ¨™æº–é”æˆ - ç”¨æ¸¬è©¦è­‰æ“š"
    - "æå–å’Œåˆ†é¡QAå•é¡Œ - ç”¨è§£æ±ºç‹€æ…‹"
    - "å…·é«”è¨˜éŒ„å·²çŸ¥å•é¡Œ - ç”¨æ¬Šå®œä¹‹è¨ˆ"
    - "è¦åŠƒæœªä¾†å¢å¼· - ç”¨æˆåŠŸæ¨™æº–"
    - "åœ¨æª¢æŸ¥é»é©—è­‰ - ç¢ºä¿æ¯éšæ®µå“è³ª"
    - "å…¨é¢åˆ†æå°ˆæ¡ˆæ–‡æª” - æ”¶é›†æ‰€æœ‰ç›¸é—œè³‡è¨Š"
    - "å®Œæˆå¾Œæ¸…ç†è‡¨æ™‚æ–‡æª” - ä¿ç•™é‡è¦ç”¢å‡º"

  workflow_violation_responses:
    missing_stage_execution: "è¿”å›ä¸¦å®Œæˆè·³éçš„éšæ®µ"
    incomplete_evidence_collection: "æ”¶é›†æ‰€æœ‰å¿…éœ€å·¥ä»¶"
    unsupported_completion_claims: "ç‚ºæ‰€æœ‰è²æ˜æä¾›è­‰æ“š"
    missing_qa_analysis: "è¨˜éŒ„QAå›é¥‹å’Œå•é¡Œ"
    generic_assessments: "ç”¨å…·é«”è³‡æ–™å’Œæ¸¬é‡æ›¿æ›"
    incomplete_template: "è­˜åˆ¥ç¼ºå¤±ç« ç¯€ä¸¦å¡«å……"
    invalid_format: "ä¿®æ­£æ ¼å¼ä»¥å®Œå…¨ç¬¦åˆç¯„æœ¬"
    incomplete_document_analysis: "å®Œæˆæ‰€æœ‰å°ˆæ¡ˆæ–‡æª”çš„åˆ†æ"
    missing_document_cleanup: "åŸ·è¡Œè‡¨æ™‚æ–‡æª”æ¸…ç†ç¨‹åº"

# çµ±ä¸€éšæ®µåŸ·è¡Œæµç¨‹
stages:
  - id: "workflow_initialization"
    title: "å·¥ä½œæµç¨‹åˆå§‹åŒ–"
    description: "è¼‰å…¥å¿…è¦æ–‡ä»¶ä¸¦è¨­ç½®çµæ¡ˆç’°å¢ƒ"
    completion_requirements:
      - workflow_file_parsed: true
      - template_structure_understood: true
      - validation_rules_loaded: true
    actions:
      - load_workflow_file: "~/cursor-claude/core/po/workflow/unified-project-concluding-workflow.yaml"
      - load_template_from: "~/cursor-claude/core/po/templates/completion-report-tmpl.yaml"
      - verify_file_accessibility

  - id: "conclusion_strategy"
    title: "çµæ¡ˆç­–ç•¥è¨­ç½®"
    description: "å»ºç«‹çµæ¡ˆç­–ç•¥å’Œè­‰æ“šæ”¶é›†è¨ˆåŠƒ"
    completion_requirements:
      - conclusion_strategy_defined: true
      - conclusion_focus_areas_defined: true
      - evidence_collection_strategy_established: true
    actions:
      - analyze_conclusion_requirements: ["scope", "delivery", "qa_reviews", "enhancements"]
      - define_conclusion_focus_areas
      - establish_evidence_collection_strategy

  - id: "evidence_collection"
    title: "å…¨é¢è­‰æ“šæ”¶é›†"
    description: "æ”¶é›†æ‰€æœ‰å¿…è¦çš„å°ˆæ¡ˆå®Œæˆè­‰æ“š"
    completion_requirements:
      - all_required_specs_read: true
      - plan_document_located_and_read: true
      - implementation_evidence_documented: true
      - quality_evidence_collected: true
      - qa_feedback_gathered_or_noted_absent: true
      - all_project_md_documents_analyzed: true
    actions:
      - read_specification_files: ["docs/specs/task.md", "docs/specs/requirements.md", "docs/specs/design.md"]
      - resolve_plan_by_task_id: "{{task_id}`(å¦‚`1`, `2`, `3`...)}"
      - read_dev_notes: "docs/dev-notes/{{task_id}`(å¦‚`1`, `2`, `3`...)}-dev-notes.md"
      - gather_implementation_evidence: ["PRs", "commits", "changed_files", "migrations", "configs"]
      - gather_quality_artifacts: ["test_reports", "coverage", "CI_status", "performance", "security_scans"]
      - gather_qa_reviews_and_feedback: "docs/implementation-review/{{task_id}`(å¦‚`1`, `2`, `3`...)}-review.md"
      - analyze_all_project_md_documents: "{{project_root}}"
      - document_evidence_gaps_as_limitations

  - id: "delivery_synthesis"
    title: "äº¤ä»˜æˆæœç¶œåˆåˆ†æ"
    description: "åˆ†æäº¤ä»˜æˆæœèˆ‡åŸå§‹ç›®æ¨™çš„å°ç…§"
    completion_requirements:
      - delivery_mapped_to_scope: true
      - acceptance_criteria_analyzed: true
      - completion_status_clearly_documented: true
    actions:
      - map_delivery_to_original_scope
      - analyze_acceptance_criteria_achievement
      - document_completion_deferred_outofscope_items
      - cross_reference_with_test_evidence
      - summarize_deliverable_status

  - id: "qa_problem_analysis"
    title: "QA æ½›åœ¨å•é¡Œåˆ†æ"
    description: "æå–ä¸¦åˆ†æ QA å›é¥‹ä¸­çš„æ½›åœ¨å•é¡Œ"
    completion_requirements:
      - qa_potential_problems_extracted: true
      - known_issues_and_risks_documented: true
      - evidence_linked_to_all_findings: true
    actions:
      - extract_qa_potential_problems_from_reviews
      - categorize_problems_by_severity_and_type
      - document_current_handling_status
      - identify_known_issues_and_risks
      - document_workarounds_and_solutions
      - link_all_findings_to_evidence

  - id: "enhancement_planning"
    title: "æœªä¾†å¢å¼·è¦åŠƒ"
    description: "åŸºæ–¼å·®è·å’ŒQAåé¥‹åˆ¶å®šæœªä¾†å¢å¼·è¨ˆåŠƒ"
    completion_requirements:
      - enhancement_opportunities_identified: true
      - enhancements_derived_from_gaps_and_qa: true
      - success_criteria_defined_for_enhancements: true
      - enhancement_priorities_established: true
    actions:
      - derive_enhancements_from_incomplete_features
      - identify_opportunities_from_qa_feedback
      - consider_performance_optimization_opportunities
      - evaluate_maintainability_improvements
      - define_measurable_success_criteria
      - set_realistic_timelines_and_estimates
      - prioritize_by_business_value_and_impact

  - id: "report_generation"
    title: "å®Œæˆå ±å‘Šç”Ÿæˆ"
    description: "ç”Ÿæˆçµæ§‹åŒ–çš„å°ˆæ¡ˆå®Œæˆå ±å‘Š"
    completion_requirements:
      - template_structure_followed: true
      - no_placeholder_values: true
      - all_evidence_linked: true
      - completion_status_clearly_documented: true
    actions:
      - load_report_template: "~/cursor-claude/core/po/templates/completion-report-tmpl.yaml"
      - populate_metadata_with_actual_values
      - populate_sections: [
          "metadata",
          "summary",
          "acceptance",
          "qa_potential_problems",
          "project_documentation_analysis",
          "known_issues_and_risks",
          "future_enhancements",
          "handover_next_steps",
          "appendix"
        ]
      - ensure_all_completion_claims_have_evidence
      - include_actual_measurements_not_estimates
      - verify_no_placeholder_content_remains

  - id: "finalization"
    title: "å®Œæˆèˆ‡å“è³ªç¢ºèª"
    description: "æœ€çµ‚é©—è­‰å’Œå“è³ªæª¢æŸ¥"
    completion_requirements:
      - final_document_read_back: true
      - completeness_verified: true
      - template_compliance_confirmed: true
      - completion_report_ready_for_stakeholders: true
      - temporary_documents_cleaned: true
    actions:
      - self_check_against_workflow
      - read_generated_document_back
      - compare_against_template_structure
      - verify_no_placeholder_values_remain
      - confirm_all_completion_claims_supported_by_evidence
      - validate_markdown_formatting_and_structure
      - request_feedback_if_needed
      - cleanup_temporary_documents: "{{project_root}}"

# === æ–°å¢ï¼šçŸ¥è­˜èˆ‡æ¶æ§‹ç”¢å‡ºæ•´åˆ ===
extensions:
  agents_integration:
    knowledge_curator:
      agent: "knowledge-curator"
      template: "~/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml"
      output: "{{project_root}}/docs/knowledge/engineering-lessons.md"
      trigger: "after:report_generation"
    architecture_documenter:
      agent: "architecture-documenter"
      template: "~/cursor-claude/core/po/templates/architecture-doc-tmpl.yaml"
      output: "{{project_root}}/docs/architecture/architecture.md"
      trigger: "after:report_generation"
    file_classifier:
      agent: "file-classifier"
      template: "~/cursor-claude/core/po/workflow/unified-file-classification-workflow.yaml"
      output: "{{project_root}}/docs/file-classification/file-classification-report.md"
      trigger: "parallel:with_conclude"

# æ•´åˆçš„é©—è­‰è¦å‰‡
validation_rules:
  template_validation:
    required_metadata_fields:
      - task_id: "actual_value_not_placeholder"
      - project_name: "actual_value_not_placeholder"
      - owner: "actual_owner_name"
      - date: "yyyy_mm_dd_format"
      - sources: "all_spec_plan_and_evidence_paths_documented"

    required_content_sections:
      - project_summary: "scope_and_completion_overview"
      - completion_status: "deliverables_and_completion_rate"
      - acceptance_criteria_achievement: "cross_reference_with_tests_evidence"
      - qa_potential_problems_summary: "concerns_and_handling_status"
      - project_documentation_analysis: "comprehensive_document_analysis_and_quality_assessment"
      - known_issues_and_risks: "defects_trade_offs_workarounds"
      - future_enhancements: "specific_proposals_with_success_criteria"
      - next_steps_and_handover: "blockers_fixes_followup_actions"
      - appendix: "testing_performance_ci_cd_data"

    evidence_requirements:
      - completion_claims_supported: "pr_links_commit_hashes_file_changes"
      - qa_issues_documented: "specific_feedback_and_current_status"
      - performance_data_included: "actual_measurements_not_estimates"
      - test_coverage_reported: "actual_coverage_percentages_and_results"
      - known_issues_specific: "exact_problem_descriptions_and_workarounds"
      - documentation_analysis_supported: "specific_document_paths_and_findings"

    forbidden_content:
      - placeholder_brackets: ["<", ">"]
      - placeholder_text: ["INSERT", "TODO", "TBD"]
      - generic_placeholders: ["{task_id}`(å¦‚`1`, `2`, `3`...)", "<project_name>", "<owner>"]
      - unsupported_claims: "all_completion_claims_must_have_evidence"
      - vague_assessments: ["generally good", "mostly complete", "acceptable quality"]
    
    document_cleanup_requirements:
      preserve_files:
        - "docs/implementation-plan/**/* - å¯¦æ–½è¨ˆåŠƒæ–‡ä»¶"
        - "docs/implementation-review/**/* - å¯¦æ–½å¯©æŸ¥æ–‡ä»¶"
        - "docs/dev-notes/**/* - é–‹ç™¼ç­†è¨˜"
        - "docs/knowledge/**/* - çŸ¥è­˜æ–‡ä»¶"
        - "docs/architecture/**/* - æ¶æ§‹æ–‡ä»¶"
        - "README.md - å°ˆæ¡ˆèªªæ˜æ–‡ä»¶"
        - "CHANGELOG.md - è®Šæ›´æ—¥èªŒ"
        - "docs/completion-reports/**/* - å®Œæˆå ±å‘Š"
      cleanup_temporary_files:
        - "è‡¨æ™‚åˆ†æéç¨‹ä¸­å‰µå»ºçš„æ–‡æª”"
        - "ç”¨æ–¼è³‡è¨Šæ”¶é›†çš„è‡¨æ™‚ç­†è¨˜"
        - "åˆ†æéç¨‹ä¸­çš„ä¸­é–“ç”¢å‡º"
        - "ä¸å±¬æ–¼æœ€çµ‚äº¤ä»˜çš„è‡¨æ™‚æ–‡ä»¶"

  error_handling:
    missing_stage:
      severity: "blocker"
      message: "Mandatory conclusion stage not completed"
      action: "halt_and_request_completion"

    incomplete_evidence_collection:
      severity: "blocker"
      message: "Required evidence not collected or documented"
      action: "halt_and_request_evidence_gathering"

    unsupported_completion_claims:
      severity: "high"
      message: "Completion claims made without supporting evidence"
      action: "flag_and_request_evidence"

    missing_qa_analysis:
      severity: "high"
      message: "QA potential problems not analyzed or documented"
      action: "request_qa_analysis_completion"

    incomplete_template:
      severity: "high"
      message: "Template section incomplete or contains placeholders"
      action: "request_template_completion"
    
    incomplete_document_analysis:
      severity: "high"
      message: "Project documentation analysis incomplete"
      action: "complete_document_analysis"
    
    missing_document_cleanup:
      severity: "medium"
      message: "Temporary documents not cleaned up"
      action: "execute_document_cleanup"

output:
  path: "{{project_root}}/docs/completion-reports/"
  filename: "{{task_id}`(å¦‚`1`, `2`, `3`...)}-completion.md"
  format: markdown
