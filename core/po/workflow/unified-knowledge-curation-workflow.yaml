# Áµ±‰∏ÄÁü•Ë≠òÁ≠ñÂ±ïÂ∑•‰ΩúÊµÅÁ®ã
# Áî®Êñº knowledge-curator agent ÁöÑÂÆåÊï¥Âü∑Ë°åÊµÅÁ®ã
# ÁâπÂà•Âº∑Ë™ø platinum Á¥öÂà•ÂØ¶Ë∏êÁöÑÁØ©ÈÅ∏ËàáË®òÈåÑ

# üîÑ Â∑•‰ΩúÊµÅÁ®ãTodo ListË£Ω‰ΩúÊµÅÁ®ã
todo_list_creation:
  description: "Âú®ÈñãÂßãÂü∑Ë°å‰ªª‰ΩïÂ∑•‰ΩúÊµÅÁ®ãÊ≠•È©ü‰πãÂâçÔºåÂøÖÈ†à‰ΩøÁî®todo_writeÂ∑•ÂÖ∑ÂâµÂª∫ÂåÖÂê´ÊâÄÊúâworkflowÊ≠•È©üÁöÑtodo list"
  importance: "critical"
  
  # üõ†Ô∏è Todo ListÂ∑•ÂÖ∑‰ΩøÁî®ÊåáÂçó
  tool_syntax:
    format: "JSON"
    structure: |
      {
        "todos": [
          {
            "content": "ÂÖ∑È´î‰ªªÂãôÊèèËø∞",
            "status": "pending|in_progress|completed",
            "id": "ÂîØ‰∏ÄË≠òÂà•Á¢º",
            "priority": "high|medium|low"
          }
        ]
      }
  
  process_steps:
    1_analyze_workflow:
      description: "ÂàÜÊûêÂ∑•‰ΩúÊµÅÁ®ãÁµêÊßã - ‰ªîÁ¥∞Èñ±ËÆÄÊï¥ÂÄãworkflowÊñá‰ª∂ÔºåË≠òÂà•ÊâÄÊúâÈöéÊÆµ„ÄÅÊ≠•È©üÂíå‰ªªÂãô"
      priority: "high"
      
    2_extract_tasks:
      description: "ÊèêÂèñÈóúÈçµ‰ªªÂãô - Â∞áÊØèÂÄãÈöéÊÆµÁöÑÊ†∏ÂøÉ‰ªªÂãôËΩâÊèõÁÇ∫ÂÖ∑È´îÁöÑtodoÈ†ÖÁõÆ"
      priority: "high"
      
    3_set_priorities:
      description: "Ë®≠ÂÆöÂÑ™ÂÖàÁ¥ö - Ê†πÊìö‰ªªÂãôÁöÑÈáçË¶ÅÊÄßÂíå‰æùË≥¥Èóú‰øÇË®≠ÂÆöÂÑ™ÂÖàÁ¥ö"
      priority: "medium"
      
    4_create_todo_list:
      description: "ÂâµÂª∫Todo List - ‰ΩøÁî®todo_writeÂ∑•ÂÖ∑ÂâµÂª∫ÂåÖÂê´ÊâÄÊúâÊ≠•È©üÁöÑÁµêÊßãÂåñtodo list"
      priority: "high"
      
    5_execute_workflow:
      description: "Âü∑Ë°åËàáÊõ¥Êñ∞ - ÊåâÁÖßtodo listÈ†ÜÂ∫èÂü∑Ë°å‰ªªÂãôÔºåÂèäÊôÇÊõ¥Êñ∞ÁãÄÊÖã"
      priority: "high"
  
  # üìù Todo ListË¶ÅÊ±Ç
  requirements:
    coverage: "ÊØèÂÄã‰∏ªË¶ÅÈöéÊÆµÈÉΩÊáâË©≤ÊúâÂ∞çÊáâÁöÑtodoÈ†ÖÁõÆ"
    validation: "ÈóúÈçµÁöÑÈ©óË≠âÊ™¢Êü•ÈªûÂøÖÈ†àÂåÖÂê´Âú®todo list‰∏≠"
    priority_setting: "Ë®≠ÂÆöÂêàÁêÜÁöÑÂÑ™ÂÖàÁ¥öÔºåÁ¢∫‰øù‰æùË≥¥Èóú‰øÇÂæóÂà∞Â∞äÈáç"
    status_tracking: "Âú®Âü∑Ë°åÈÅéÁ®ã‰∏≠ÂèäÊôÇÊõ¥Êñ∞todoÁãÄÊÖãÔºàpending ‚Üí in_progress ‚Üí completedÔºâ"
    uniqueness: "ÂêåÊôÇÂè™ËÉΩÊúâ‰∏ÄÂÄã‰ªªÂãôËôïÊñºin_progressÁãÄÊÖã"
    completeness: "Âè™ÊúâÂú®‰ªªÂãôÂÆåÂÖ®ÂÆåÊàêÊôÇÊâçÊ®ôË®òÁÇ∫completed"
    status_tracking: "Âú®Âü∑Ë°åÈÅéÁ®ã‰∏≠ÂèäÊôÇÊõ¥Êñ∞todoÁãÄÊÖãÔºàpending ‚Üí in_progress ‚Üí completedÔºâ"

# ÂàÜÈöîÁ∑öÔºå‰ª•‰∏ãÁÇ∫ÂéüÂßãworkflowÂÖßÂÆπ
---

workflow_name: "unified-knowledge-curation-workflow"
version: "2.2.0"
description: "ÂæûÂØ©Êü•Â†±ÂëäËàáÂÆåÊàêÂ†±Âëä‰∏≠Á≠ñÂ±ïÂÑ™ÁßÄÂØ¶Ë∏êËàáÈåØË™§Ê®°ÂºèÔºåÂÉÖË®òÈåÑplatinumÁ¥öÂà•ÂØ¶Ë∏ê"

# Â∑•‰ΩúÊµÅÁ®ãÂü∑Ë°åË®≠ÂÆö
execution_settings:
  deterministic: true
  parallel_enabled: true
  max_parallel_tasks: 10
  batch_size: 7
  cache_enabled: true
  fail_fast: false  # Ë®òÈåÑÈåØË™§‰ΩÜ‰∏ç‰∏≠Êñ∑
  
# ÂâçÁΩÆÊ¢ù‰ª∂Ê™¢Êü•
prerequisites:
  required_files:
    # Ê†∏ÂøÉÈÖçÁΩÆÊ™îÊ°à
    - path: "~/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml"
      type: "template"
      critical: false  # Áº∫Â§±ÊôÇË®òÈåÑË≠¶Âëä‰∏¶ÊåÅÁ∫å
    - path: "~/cursor-claude/core/po/enforcement/knowledge-curator-enforcement.md"
      type: "enforcement"
      critical: false
      
  optional_directories:
    # ‰æÜÊ∫êË≥áÊñôÁõÆÈåÑÔºàÂèØËÉΩ‰∏çÂ≠òÂú®Ôºâ
    - path: "{{project_root}}/docs/implementation-review/"
      type: "source"
      pattern: "*.md"
    - path: "{{project_root}}/docs/completion-reports/"
      type: "source" 
      pattern: "*-completion.md"
      
  validation_rules:
    - rule: "project_root_resolved"
      description: "project_root ÂøÖÈ†àËß£ÊûêÁÇ∫ÊúâÊïàË∑ØÂæë"
    - rule: "output_directory_writable"
      description: "{{project_root}}/docs/knowledge/ ÂøÖÈ†àÂèØÂØ´"

# ‰∏ªË¶ÅÂü∑Ë°åÈöéÊÆµ
stages:

  # ÈöéÊÆµ 1ÔºöÁí∞Â¢ÉÊ∫ñÂÇôËàáÁ¢∫ÂÆöÊÄßË®≠ÂÆö
  - name: "preparation"
    description: "ËºâÂÖ•Ë®≠ÂÆö‰∏¶Ê∫ñÂÇôÂü∑Ë°åÁí∞Â¢É"
    parallel: false
    steps:
      - name: "load_template"
        action: "read_file"
        target: "~/cursor-claude/core/po/templates/knowledge-lessons-tmpl.yaml"
        required: false
        on_failure: "log_warning"
        
      - name: "load_enforcement"
        action: "read_file"
        target: "~/cursor-claude/core/po/enforcement/knowledge-curator-enforcement.md"
        required: false
        on_failure: "log_warning"
        
      - name: "verify_output_path"
        action: "ensure_directory"
        target: "{{project_root}}/docs/knowledge/"
        permissions: "write"

  # ÈöéÊÆµ 2Ôºö‰æÜÊ∫êË≥áÊñôÊéÉÊèèËàáÊî∂ÈõÜ
  - name: "source_discovery"
    description: "‰∏¶Ë°åÊéÉÊèè‰æÜÊ∫êÊñá‰ª∂‰∏¶Êî∂ÈõÜÂéüÂßãË≥áÊñô"
    parallel: true
    depends_on: ["preparation"]
    steps:
      - name: "scan_review_reports"
        action: "glob_search"
        target: "{{project_root}}/docs/implementation-review/*.md"
        extract_patterns:
          - "error_log"
          - "findings"
          - "quality_assessment"
        on_empty: "log_info"  # Ê≤íÊúâÊ™îÊ°à‰∏çÊòØÈåØË™§
        
      - name: "scan_completion_reports"
        action: "glob_search"
        target: "{{project_root}}/docs/completion-reports/*-completion.md"
        extract_patterns:
          - "implementation_maturity"
          - "quality_assessment"
          - "summary_score"
        on_empty: "log_info"
        
      - name: "load_existing_knowledge"
        action: "read_file"
        target: "{{project_root}}/docs/knowledge/engineering-lessons.md"
        required: false
        on_failure: "create_new"

  # ÈöéÊÆµ 3ÔºöÂìÅË≥™ÁØ©ÈÅ∏ËàáË≥áÊñôÈ†êËôïÁêÜ
  - name: "quality_filtering"
    description: "Ê†πÊìöÂìÅË≥™Ê®ôÊ∫ñÁØ©ÈÅ∏Ë≥áÊñôÔºåÂº∑Ë™øplatinumÁ¥öÂà•"
    parallel: false
    depends_on: ["source_discovery"]
    steps:
      - name: "extract_platinum_practices"
        action: "filter_practices"
        criteria:
          - "implementation_maturity >= 'platinum'"
          - "quality_assessment.summary_score >= 4"
          - "qa_positive_feedback = true"
        output: "platinum_practices_list"
        minimum_threshold: 0  # ÂÖÅË®±Á©∫ÁµêÊûú
        
      - name: "categorize_error_patterns"
        action: "analyze_errors"
        source: "error_log"
        severity_order: ["blocker", "high", "medium", "low"]
        grouping: "pattern_similarity"
        output: "categorized_errors"
        
      - name: "validate_evidence_links"
        action: "verify_links"
        targets: ["file_paths", "pr_links", "commit_hashes"]
        on_broken_link: "log_warning"

  # ÈöéÊÆµ 4ÔºöÊ®°ÂºèË≠òÂà•ËàáÂàÜÊûê
  - name: "pattern_analysis"
    description: "Ë≠òÂà•ÈåØË™§Ê®°ÂºèËàáÊàêÂäüÂØ¶Ë∏êÁöÑÊ∑±Â±§Ê®°Âºè"
    parallel: true
    depends_on: ["quality_filtering"]
    steps:
      - name: "identify_error_patterns"
        action: "pattern_recognition"
        source: "categorized_errors"
        techniques:
          - "frequency_analysis"
          - "co_occurrence_analysis"
          - "root_cause_clustering"
        output: "error_patterns"
        
      - name: "analyze_success_patterns"
        action: "pattern_recognition"
        source: "platinum_practices_list"
        techniques:
          - "context_analysis"
          - "outcome_correlation"
          - "replicability_assessment"
        output: "success_patterns"
        
      - name: "cross_reference_patterns"
        action: "cross_analysis"
        sources: ["error_patterns", "success_patterns"]
        identify: "prevention_opportunities"
        output: "prevention_matrix"

  # ÈöéÊÆµ 5ÔºöÁü•Ë≠òÁµêÊßãÂåñËàáÁµÑÁπî
  - name: "knowledge_structuring"
    description: "Â∞áÂàÜÊûêÁµêÊûúÁµÑÁπîÊàê‰∏âÂ±§Áü•Ë≠òÁµêÊßã"
    parallel: false
    depends_on: ["pattern_analysis"]
    steps:
      - name: "create_quick_reference"
        action: "generate_structure"
        template: "emergency_lookup_table"
        source: "error_patterns"
        criteria: "frequency_and_severity"
        max_entries: 20
        format: "symptoms_to_solutions"
        
      - name: "build_detailed_analysis"
        action: "generate_structure"
        template: "comprehensive_analysis"
        sources: ["error_patterns", "success_patterns", "prevention_matrix"]
        include_evidence: true
        include_case_studies: true
        
      - name: "design_prevention_guides"
        action: "generate_structure"
        template: "prevention_framework"
        source: "prevention_matrix"
        focus: "proactive_measures"
        include_tools: true
        include_checklists: true

  # ÈöéÊÆµ 6ÔºöËº∏Âá∫ÁîüÊàêËàáÊ†ºÂºèÂåñ
  - name: "output_generation"
    description: "Ê†πÊìöÊ®°ÊùøÁîüÊàêÊúÄÁµÇÁü•Ë≠òÊñáÊ™î"
    parallel: false
    depends_on: ["knowledge_structuring"]
    steps:
      - name: "populate_template"
        action: "template_fill"
        template_source: "knowledge-lessons-tmpl.yaml"
        data_sources:
          - "quick_reference"
          - "detailed_analysis"
          - "prevention_guides"
        placeholder_handling: "mark_as_na_with_reason"
        
      - name: "add_metadata"
        action: "add_metadata"
        fields:
          - "generation_timestamp"
          - "source_file_count"
          - "platinum_practices_count"
          - "error_patterns_count"
          - "evidence_quality_score"
          
      - name: "apply_formatting"
        action: "format_document"
        standards:
          - "consistent_headers"
          - "unified_code_blocks"
          - "standardized_links"
          - "sorted_lists"

  # ÈöéÊÆµ 7ÔºöÂìÅË≥™È©óË≠âËàáËº∏Âá∫
  - name: "quality_validation"
    description: "È©óË≠âËº∏Âá∫ÂìÅË≥™‰∏¶ÂØ´ÂÖ•Ê™îÊ°à"
    parallel: false
    depends_on: ["output_generation"]
    steps:
      - name: "validate_content"
        action: "content_validation"
        checks:
          - "no_placeholders_remaining"
          - "evidence_links_valid"
          - "structure_compliance"
          - "minimum_content_length"
        failure_action: "log_and_continue"
        
      - name: "validate_platinum_threshold"
        action: "threshold_validation"
        criteria:
          - rule: "platinum_practices_only"
            description: "Á¢∫‰øùÂè™ÊúâplatinumÁ¥öÂà•ÂØ¶Ë∏êË¢´Ë®òÈåÑ"
            validation: "implementation_maturity >= 'platinum'"
          - rule: "evidence_supported"
            description: "Á¢∫‰øù100%ÁöÑÊ¢ùÁõÆÊúâË≠âÊìöÊîØÊåÅ"
            validation: "evidence_links_present = true"
        
      - name: "write_output"
        action: "write_file"
        target: "{{project_root}}/docs/knowledge/engineering-lessons.md"
        backup: true
        backup_path: "{{project_root}}/docs/knowledge/engineering-lessons-{{timestamp}}.md"
        
      - name: "update_index"
        action: "update_index"
        target: "{{project_root}}/docs/knowledge/index.md"
        add_entry: "engineering-lessons.md"
        include_metadata: true

# Ë≥áÊñôÂìÅË≥™Ê®ôÊ∫ñ
quality_standards:
  platinum_practices:
    minimum_score: 4.0
    required_maturity: "platinum"
    evidence_requirement: "mandatory"
    success_rate_threshold: 0.8
    
  error_patterns:
    minimum_frequency: 2
    severity_threshold: "medium"
    reproducibility_requirement: true
    
  evidence_links:
    validity_check: true
    accessibility_check: true
    freshness_threshold_days: 180

# ÈåØË™§ËôïÁêÜÁ≠ñÁï•
error_handling:
  source_file_missing:
    action: "log_warning"
    continue: true
    message: "‰æÜÊ∫êÊñá‰ª∂Áº∫Â§±ÔºåÂ∞á‰ª•ÁèæÊúâË≥áÊñôÁπºÁ∫åËôïÁêÜ"
    
  template_load_failure:
    action: "use_fallback"
    fallback: "minimal_template"
    continue: true
    
  evidence_link_broken:
    action: "mark_as_questionable"
    continue: true
    include_in_validation_warnings: true
    
  platinum_threshold_unmet:
    action: "filter_out"
    continue: true
    log_filtered_items: true

# ‰∏¶Ë°åËôïÁêÜÁ≠ñÁï•
parallelization:
  source_discovery:
    max_concurrent: 5
    timeout_per_task: 30
    
  pattern_analysis:
    max_concurrent: 3
    shared_cache: true
    
  validation:
    sequential_required: true
    reason: "Á¢∫‰øùË≥áÊñô‰∏ÄËá¥ÊÄß"

# Âø´ÂèñÁ≠ñÁï•
caching:
  source_files:
    strategy: "content_hash"
    ttl_hours: 24
    invalidation_triggers: ["file_modification", "size_change"]
    
  analysis_results:
    strategy: "dependency_hash"
    ttl_hours: 12
    cache_key_components: ["source_hash", "template_version", "config_hash"]

# Ëº∏Âá∫È©óË≠âË¶èÂâá
validation_rules:
  content_quality:
    - rule: "no_empty_sections"
      severity: "warning"
    - rule: "evidence_links_present"
      severity: "error"
      threshold: 100  # 100% ÁöÑÊ¢ùÁõÆÂøÖÈ†àÊúâË≠âÊìö
    - rule: "platinum_only"
      severity: "error" 
      description: "Âè™ÂÖÅË®± platinum Á¥öÂà•ÂØ¶Ë∏ê"
      
  format_compliance:
    - rule: "template_structure_followed"
      severity: "error"
    - rule: "consistent_formatting"
      severity: "warning"
    - rule: "sorted_lists"
      severity: "info"

# ÊàêÂäüÊåáÊ®ô
success_metrics:
  process_metrics:
    - "source_files_processed"
    - "patterns_identified"
    - "platinum_practices_collected"
    - "error_patterns_categorized"
    
  quality_metrics:
    - "evidence_link_validity_rate"
    - "platinum_practice_ratio"
    - "knowledge_freshness_score"
    - "cross_reference_accuracy"
    
  impact_metrics:
    - "knowledge_base_growth"
    - "pattern_coverage_improvement"
    - "prevention_opportunity_identification"

# ÂæåËôïÁêÜË°åÂãï
post_processing:
  knowledge_base_maintenance:
    - action: "remove_outdated_entries"
      criteria: "last_updated > 1_year AND no_recent_validation"
    - action: "merge_similar_patterns"
      threshold: "similarity_score > 0.8"
    - action: "update_cross_references"
      scope: "all_related_entries"
      
  continuous_improvement:
    - action: "analyze_usage_patterns"
      source: "access_logs"
    - action: "identify_gaps"
      method: "frequency_vs_coverage_analysis"
    - action: "suggest_collection_priorities"
      based_on: "gap_analysis_results"

# Âü∑Ë°åÂ†±ÂëäÊ®°Êùø
execution_report:
  summary:
    - "total_sources_processed"
    - "platinum_practices_identified"
    - "error_patterns_discovered"
    - "prevention_opportunities_created"
    
  details:
    - "source_file_breakdown"
    - "quality_filtering_results"
    - "pattern_analysis_insights"
    - "evidence_validation_report"
    
  recommendations:
    - "knowledge_collection_priorities"
    - "process_improvement_suggestions"
    - "tool_enhancement_opportunities"
