# Architecture Documenter 強制執行規範

## 核心執行協議

### 必要前置條件（寬鬆）
- **建議**：開始前載入模板與來源文件；若缺失，記錄至 validation_warnings 並持續
- **模板讀取**：應讀取 `/Users/tszkinlai/Coding/AI workflow/core/templates/architecture-doc-tmpl.yaml`，失敗則記錄警告
- **來源讀取**：應讀取並掃描指定來源路徑；缺失則記錄警告並以現有資訊繼續

### 文檔完整性（強制執行）
- **結構合規**：必須遵循 `architecture-doc-tmpl.yaml` 的結構
- **內容完整**：所有必需部分都必須有實際內容或標記為 "N/A - [原因]"
- **佔位符清除**：不得有未填充的 `<placeholder>` 值
- **圖表要求**：至少包含系統上下文圖、容器圖、元件圖

### 真實性與同步性（絕對強制）
- **代碼一致性**：架構描述必須與實際代碼庫一致
- **API契約同步**：API文檔必須反映實際的接口實現
- **資料模型對齊**：資料模型必須與實際資料庫結構一致
- **差異標註**：若存在不一致，必須明確標註差異和演進計劃

### 可追溯性要求（強制執行）
- **來源鏈結**：每個架構決策都必須能追溯到設計文件或實施計劃
- **代碼位置**：重要元件必須提供快速導航到代碼位置的鏈結
- **版本控制**：必須記錄文檔版本與對應的代碼版本
- **變更追蹤**：重要架構變更必須記錄在ADR中

### Mermaid圖表要求（強制標準）
- **系統上下文圖**：必須顯示系統與外部實體的關係
- **容器圖**：必須顯示主要服務和資料存儲
- **元件圖**：必須顯示關鍵模組的內部結構
- **資料流圖**：必須顯示用戶旅程的資料流轉

### 多層次導航（強制實施）
- **快速導航**：必須提供從概覽到實施細節的快速跳轉
- **交叉參考**：相關元件之間必須有明確的鏈結
- **索引結構**：必須建立清晰的文檔索引和目錄結構
- **搜索友好**：必須使用一致的命名和標籤系統

### 業務價值連結（強制執行）
- **用戶旅程**：必須以用戶旅程為主線串接技術架構
- **業務目標**：技術決策必須能追溯到業務目標
- **價值對應**：每個技術元件都必須說明其業務價值
- **ROI考量**：重要架構決策必須考慮投資回報率

### 維護性要求（強制保證）
- **新人友好**：文檔必須讓新人在一天內理解系統
- **更新機制**：必須建立文檔與代碼同步更新的機制
- **責任分工**：必須明確不同元件的維護責任
- **演進規劃**：必須標註系統的未來演進方向

### 架構決策記錄（強制要求）
- **ADR鏈結**：重要架構決策必須鏈結到對應的ADR
- **決策背景**：必須記錄決策的背景和考量因素
- **替代方案**：必須說明考慮過的替代方案
- **後果評估**：必須評估決策的正面和負面後果

### 一致性檢查（強制驗證）
- **計劃對齊**：架構文檔必須與實施計劃一致
- **規範對齊**：必須與需求和設計規範保持一致
- **代碼對齊**：必須與實際代碼實現保持同步
- **差異處理**：發現不一致時必須明確標註並制定同步計劃

### 品質標準（強制達到）
- **技術準確性**：所有技術描述必須準確無誤
- **視覺清晰**：圖表必須清晰易讀，邏輯合理
- **語言簡潔**：文字描述必須簡潔明瞭，避免冗餘
- **結構邏輯**：文檔結構必須邏輯清晰，易於導航

### 協作友好性（強制實施）
- **團隊溝通**：文檔必須促進不同角色間的有效溝通
- **知識傳承**：必須支持知識在團隊成員間的有效傳承
- **決策支持**：必須為架構決策提供充分的支持資訊
- **風險識別**：必須標註潛在的架構風險和改進機會

### 安全要求（強制遵守）
- **只讀保護**：絕不修改 `docs/specs/` 中的任何檔案
- **權限控制**：確保只訪問授權的檔案和資源
- **敏感資訊**：避免在文檔中暴露敏感的系統資訊
- **訪問記錄**：記錄所有文檔訪問和修改操作

### 輸出位置（固定）
- **主文檔**：`{project_root}/docs/architecture/architecture.md`
- **圖表目錄**：`{project_root}/docs/architecture/diagrams/`
- **ADR目錄**：`{project_root}/docs/architecture/decisions/`
- **模板參考**：`/Users/tszkinlai/Coding/AI workflow/core/templates/architecture-doc-tmpl.yaml`

## 架構文檔檢查清單（強制執行）

### 內容完整性檢查
- [ ] 系統上下文圖已繪製且準確
- [ ] 容器視圖包含所有主要服務
- [ ] 元件圖顯示關鍵模組結構
- [ ] 資料模型與實際資料庫一致
- [ ] API契約反映實際接口
- [ ] 部署和可觀測性資訊完整

### 技術準確性檢查
- [ ] 所有技術描述與實際實現一致
- [ ] 依賴關係圖準確反映現實
- [ ] 資料流程與實際業務流程對齊
- [ ] 監控和日誌策略與實施一致

### 可用性檢查
- [ ] 新人能在一天內理解系統結構
- [ ] 提供快速導航到代碼位置的路徑
- [ ] 不同層次的讀者都能找到所需資訊
- [ ] 交叉參考和鏈結功能正常

### 維護性檢查
- [ ] 文檔與代碼同步更新機制已建立
- [ ] 責任分工清晰明確
- [ ] 演進規劃和風險標註完整
- [ ] ADR鏈結和決策記錄完整

## 品質門檻（強制通過）
- **準確性**：架構描述必須100%與實際實現一致
- **完整性**：所有必需元件都必須有完整描述
- **可讀性**：文檔必須能被目標受眾輕鬆理解
- **可維護性**：文檔必須支持長期維護和更新

## 失敗處理協議（記錄並續行）
- **來源文件缺失**：記錄缺失與替代資訊來源；繼續現有資訊處理
- **代碼同步失敗**：記錄不一致與同步計劃；標註差異繼續
- **圖表生成失敗**：記錄失敗原因與手動補充計劃；不中斷
- **ADR鏈結缺失**：記錄缺失與補充計劃；繼續文檔編纂
- **模板不合規**：記錄差異與修正計劃；不中斷輸出
