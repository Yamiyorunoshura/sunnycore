{
  "prompt_name": "brownfield-tasks",
  "review_date": "2025-10-02",
  "reviewer": "sunnycore_prompt-reviewer",
  "overall_score": 4.4,
  "pass_threshold": 4.0,
  "status": "合格",
  "dimensions": {
    "structure_integrity": {
      "score": 4.5,
      "weight": 1.5,
      "items": [
        {
          "name": "區段完整性",
          "score": 5.0,
          "evidence": "[輸入]L1-6、[輸出]L7-11、[約束]L12-16、[工具]L17-26、[工具指引]L27-40、[步驟]L41-57、[DoD]L58-62",
          "comment": "所有必要區段齊全，涵蓋操作類提示詞的完整結構"
        },
        {
          "name": "邏輯一致性",
          "score": 4.5,
          "evidence": "[工具]L17-26與[工具指引]L27-40對應清晰；[步驟]L41-57與[輸出]L7-11對齊",
          "comment": "工具與指引關聯明確，步驟與產出對應良好"
        },
        {
          "name": "輸入輸出對應",
          "score": 4.0,
          "evidence": "[輸入]L1-6列出4項輸入（模板、筆記、報告、架構），[輸出]L7-11列出3項輸出；但未在[約束]或[步驟]要求驗證輸入存在性",
          "comment": "輸入輸出清晰但缺少驗證機制"
        }
      ],
      "recommendations": [
        "在[約束]L12-16加入「必須驗證所有輸入檔案存在且格式正確」",
        "在[步驟]L42-47準備階段開頭加入「驗證輸入檔案完整性」子步驟"
      ]
    },
    "expression_clarity": {
      "score": 4.0,
      "weight": 2.0,
      "items": [
        {
          "name": "指令明確性",
          "score": 4.5,
          "evidence": "[步驟]L50-52「測試通過條件：指令退出碼必須為0」明確；[DoD]L58-62列出可驗證標準",
          "comment": "測試標準與完成條件表述精確"
        },
        {
          "name": "術語定義充分性",
          "score": 3.0,
          "evidence": "[步驟]L47「原子化的修復任務」未定義何謂原子化；[輸出]L10「建議格式，可根據專案需求調整」缺乏具體範例",
          "comment": "關鍵術語缺少定義或範例，可能導致理解差異"
        },
        {
          "name": "避免歧義",
          "score": 4.0,
          "evidence": "[步驟]L46「思考問題所在」為抽象描述；[輸出]L10「建議格式」允許彈性但缺邊界",
          "comment": "大部分指令明確，少數表述略顯抽象"
        },
        {
          "name": "可理解性",
          "score": 4.5,
          "evidence": "[步驟]L42-47準備階段、L48-53修復階段、L54-57總結階段，三階段邏輯清晰",
          "comment": "整體結構易於理解，流程邏輯順暢"
        }
      ],
      "recommendations": [
        "為[步驟]L47「原子化的修復任務」補充定義：「單一職責、可獨立測試、變更範圍<100行或<5檔案的修復任務」",
        "為[輸出]L10「修復總結」提供格式範例：「## Changes\n- ...\n## Tests\n- ...\n## Evidence\n- file:line\n## Risk\n- ...\n## Rollback\n- ...」",
        "將[步驟]L46「思考問題所在」改為「分析問題根因：檢查錯誤訊息、堆疊追蹤、程式碼邏輯、架構設計對比」"
      ]
    },
    "constraint_validity": {
      "score": 4.2,
      "weight": 2.0,
      "items": [
        {
          "name": "邊界定義",
          "score": 4.0,
          "evidence": "[約束]L13-16定義三層約束（正常運行、符合架構、不破壞功能）",
          "comment": "約束層次清晰但缺少修改範圍限制"
        },
        {
          "name": "風險控制",
          "score": 4.5,
          "evidence": "[步驟]L50-53雙層測試（單元+整合）要求；L52失敗回滾機制（git reset或手動撤銷）；[輸出]L10包含rollback欄位",
          "comment": "風險控制機制完善，測試與回滾並重"
        },
        {
          "name": "強制性",
          "score": 4.0,
          "evidence": "[約束]L13-16使用「你需要確保」表達強制；[DoD]L58-62作為完成門檻",
          "comment": "約束語氣明確但缺違反後果說明"
        }
      ],
      "recommendations": [
        "在[約束]加入「單次修復範圍不超過5個檔案或500行程式碼」以確保原子性與可控性",
        "在[約束]補充「禁止修改核心API介面或公開契約」等安全邊界",
        "建議在修復前要求自動建立備份分支（如git branch backup/{task_id}）"
      ]
    },
    "tool_guidance_completeness": {
      "score": 4.5,
      "weight": 1.5,
      "items": [
        {
          "name": "工具覆蓋度",
          "score": 4.5,
          "evidence": "[工具]L17-26列出3工具：todo_write（任務追蹤）、sequentialthinking（推理）、claude-context（程式碼搜尋）",
          "comment": "工具涵蓋任務管理、思考、搜尋三大核心需求"
        },
        {
          "name": "使用場景說明",
          "score": 4.5,
          "evidence": "[工具]L18-26明確標註使用時機（步驟1/2對應）",
          "comment": "每個工具都有清晰的使用場景描述"
        },
        {
          "name": "指引具體性",
          "score": 4.5,
          "evidence": "[工具指引]L29-34 sequentialthinking推理步數規範（簡單1-3、中等3-5、複雜5-8）；L35-37 claude-context使用方法；L38-40 todo_write狀態閘門規則",
          "comment": "工具指引詳細且規則明確，可直接操作"
        }
      ],
      "recommendations": [
        "維持現有工具指引品質",
        "若未來工具增加至5個以上，考慮將工具指引獨立為附錄"
      ]
    },
    "step_completeness": {
      "score": 4.5,
      "weight": 1.5,
      "items": [
        {
          "name": "流程邏輯",
          "score": 5.0,
          "evidence": "[步驟]L41-57定義準備→修復→總結三階段，順序合理且完整",
          "comment": "流程邏輯清晰，階段劃分合理"
        },
        {
          "name": "可操作性",
          "score": 4.0,
          "evidence": "[步驟]L42-47列出具體閱讀對象；L50-53指定測試指令範例（pytest -q, make test）；但L46「思考問題所在」略顯抽象",
          "comment": "大部分步驟可直接執行，少數步驟需更具體"
        },
        {
          "name": "產物驗證",
          "score": 4.5,
          "evidence": "[DoD]L58-62列出3項可驗證標準（單元測試、整合測試、開發筆記）；[步驟]L50-52指定退出碼=0為通過標準",
          "comment": "產物與驗證標準明確，可客觀評估"
        }
      ],
      "recommendations": [
        "將[步驟]L46具體化為「分析問題：1)查看審查報告問題點 2)對比架構設計找出偏差 3)檢視程式碼邏輯與錯誤訊息」",
        "在[步驟]L47補充任務拆解範例：「如修復認證問題→拆分為：修正token驗證邏輯、更新測試、更新文件」"
      ]
    },
    "practical_feasibility": {
      "score": 4.2,
      "weight": 2.0,
      "items": [
        {
          "name": "測試可執行性",
          "score": 5.0,
          "evidence": "[步驟]L50-53提供pytest/make test範例，退出碼標準明確（=0為通過），雙層測試（單元+整合）要求清晰",
          "comment": "測試指令具體可執行，標準客觀明確"
        },
        {
          "name": "證據可追溯性",
          "score": 4.0,
          "evidence": "[工具指引]L37要求「標註來源文件與行號」；[步驟]L56要求「文件路徑與行號/段落ID...PR/commit連結」；但缺統一格式範例",
          "comment": "證據要求清晰但缺標準化格式"
        },
        {
          "name": "異常處理",
          "score": 3.5,
          "evidence": "[步驟]L52「若失敗（退出碼≠0）應使用 git reset 或手動撤銷最近變更並修復後重試」",
          "comment": "提供失敗處理方案，但缺連續失敗升級機制"
        }
      ],
      "recommendations": [
        "在[工具指引]L37或[步驟]L56統一證據格式：「格式：`檔案路徑:行號` 或 `L起始-L結束`，範例：`src/auth.py:45-60` 或 `[約束]L13-L16`」",
        "在[步驟]L52補充「若連續3次修復失敗，記錄問題並請求人工介入」",
        "建議在[輸出]加入證據格式示例區塊"
      ]
    },
    "token_efficiency": {
      "score": 5.0,
      "weight": 1.0,
      "items": [
        {
          "name": "簡潔性",
          "score": 5.0,
          "evidence": "全文共62行，涵蓋完整流程（輸入、輸出、約束、工具、指引、步驟、DoD），資訊密度高",
          "comment": "表達簡潔，無冗長描述"
        },
        {
          "name": "避免冗餘",
          "score": 5.0,
          "evidence": "各區段職責分明，工具與工具指引分離但不重複，步驟描述精煉",
          "comment": "無重複或冗餘內容"
        },
        {
          "name": "表達精煉",
          "score": 5.0,
          "evidence": "[步驟]L50-52單句表達完整測試標準；平均每行承載明確語義",
          "comment": "資訊密度適中，易於理解且完整"
        }
      ],
      "recommendations": [
        "維持現有簡潔風格",
        "若未來擴充內容，優先考慮分離附錄而非內嵌擴展"
      ]
    }
  },
  "summary": {
    "strengths": [
      "結構完整且邏輯清晰：涵蓋輸入、輸出、約束、工具、工具指引、步驟、DoD七大區段，分工明確",
      "測試要求嚴謹：雙層測試（單元+整合）且明確指定通過標準（退出碼=0），確保程式碼品質",
      "工具指引詳細：sequentialthinking推理步數、claude-context搜尋方法、todo_write狀態閘門規則清晰",
      "Token效率優秀：62行涵蓋完整流程，簡潔且資訊密度高，無冗餘內容",
      "風險控制完善：包含三層約束、雙層測試、失敗回滾機制，安全性高",
      "證據追溯要求明確：要求文件路徑、行號、PR/commit連結，便於審計"
    ],
    "weaknesses": [
      "關鍵術語缺定義：「原子化的修復任務」未定義，可能導致理解不一致",
      "輸出格式略顯模糊：「修復總結」建議格式但缺具體範例，影響產出一致性",
      "證據格式未統一：未提供標準化引用格式（如 file:line 或 [區塊]Lx-Ly），可能導致格式不一致",
      "異常升級機制缺失：未說明連續失敗後的處理流程，可能造成無限重試",
      "輸入驗證不明確：未在約束或步驟強制要求驗證檔案存在性",
      "修改範圍無限制：缺少單次修復的範圍約束（檔案數/行數限制）"
    ],
    "priority_improvements": [
      {
        "priority": "高",
        "item": "補充「原子化的修復任務」定義",
        "rationale": "核心概念模糊會直接影響任務拆解品質與修復範圍控制",
        "suggested_location": "[步驟]L47或[約束]區段",
        "suggested_content": "定義：單一職責、可獨立測試、變更範圍<100行或<5檔案的修復任務"
      },
      {
        "priority": "高",
        "item": "提供「修復總結」格式範例",
        "rationale": "輸出格式不明確會影響報告一致性、可讀性與後續自動化處理",
        "suggested_location": "[輸出]L10或新增[輸出格式範例]區段",
        "suggested_content": "範例：## Changes\n- ...\n## Tests\n- ...\n## Evidence\n- src/file.py:45-60\n## Risk\n- ...\n## Rollback\n- git reset --hard {commit}"
      },
      {
        "priority": "中",
        "item": "統一證據引用格式",
        "rationale": "標準化格式有助於自動化解析、審計與後續追蹤",
        "suggested_location": "[工具指引]L37或[步驟]L56",
        "suggested_content": "格式：`檔案路徑:行號` 或 `[區塊名稱]Lx-Ly`，範例：`src/auth.py:45-60` 或 `[約束]L13-L16`"
      },
      {
        "priority": "中",
        "item": "加入輸入驗證步驟",
        "rationale": "防止因檔案缺失或格式錯誤導致流程中斷或產出錯誤",
        "suggested_location": "[約束]區段或[步驟]L42準備階段開頭",
        "suggested_content": "驗證所有輸入檔案存在且格式正確；缺失時中止並報告"
      },
      {
        "priority": "中",
        "item": "補充連續失敗升級機制",
        "rationale": "避免無限重試消耗資源，提升問題解決效率",
        "suggested_location": "[步驟]L52或新增[異常處理]區段",
        "suggested_content": "若連續3次修復失敗，記錄問題詳情並請求人工介入"
      },
      {
        "priority": "低",
        "item": "定義修復範圍限制",
        "rationale": "確保修復任務的原子性與可控性，降低風險",
        "suggested_location": "[約束]區段",
        "suggested_content": "單次修復範圍不超過5個檔案或500行程式碼；超出需拆分為多個任務"
      }
    ]
  },
  "destructive_optimization_suggestions": [
    {
      "type": "架構調整",
      "suggestion": "將[工具指引]獨立為外部參考文件或附錄",
      "impact": "破壞現有一體化結構，需調整引用方式與檔案管理",
      "rationale": "當工具種類持續增長（>5個）時，內嵌指引會影響主流程可讀性；分離可提升主文件簡潔度",
      "consideration": "若工具種類<5個，建議維持現狀；若>5個或指引內容>30行，考慮分離",
      "pros": "主流程更簡潔、工具指引可獨立維護與版本管理",
      "cons": "增加檔案數量、需要管理引用關係、可能降低新手理解的連貫性"
    },
    {
      "type": "語意轉換",
      "suggestion": "將抽象步驟改為詳細子任務清單",
      "impact": "改變現有抽象→具體的敘事風格，可能降低彈性與適應性",
      "rationale": "提升可操作性但可能過於規定性，適合標準化流程但不利創新式修復",
      "consideration": "適用於固定化、重複性高的修復任務；若需應對複雜或多樣化問題，現行抽象方式更佳",
      "example": "將步驟1「閱讀並理解審查報告」改為「1.1打開審查報告 1.2標記問題點 1.3評估嚴重性 1.4排列優先順序」",
      "pros": "降低認知負荷、提升新手執行成功率、便於自動化",
      "cons": "降低彈性、可能限制創造性解決方案、文件長度增加"
    },
    {
      "type": "約束強化",
      "suggestion": "將被動約束改為主動檢查點（Checkpoint）機制",
      "impact": "改變約束執行模式（被動宣告→主動驗證），需重構步驟流程並插入驗證節點",
      "rationale": "提升約束執行力與可驗證性，但增加流程複雜度與執行成本",
      "consideration": "適合高風險專案（如金融、醫療系統）；一般專案現行被動約束已足夠",
      "example": "在步驟間插入：「Checkpoint 1: 驗證架構符合性（執行架構驗證腳本，不通過則中止）」",
      "pros": "強制執行約束、提早發現問題、降低後期修復成本",
      "cons": "增加流程複雜度與執行時間、可能影響開發靈活性"
    },
    {
      "type": "產物擴充",
      "suggestion": "要求產出變更影響分析報告",
      "impact": "新增輸出項目，改變現有輸出結構與完成定義",
      "rationale": "提升變更透明度與風險可見性，但增加產出成本",
      "consideration": "適合大型專案或多團隊協作環境；小型專案可能過度設計",
      "example": "新增輸出：變更影響分析（受影響模組、相依性變更、潛在連鎖影響、測試範圍建議）",
      "pros": "提升變更可預測性、降低意外副作用、便於評審決策",
      "cons": "增加工作量與時間成本、可能降低修復效率"
    }
  ],
  "metadata": {
    "prompt_version": "unknown",
    "prompt_path": "claude code/tasks/brownfield-tasks.md",
    "total_lines": 62,
    "review_methodology": "7維度加權評分制（高權重×2.0、中權重×1.5、標準權重×1.0），採0-5評分制，證據以[區塊名稱]Lx-Ly標註",
    "reviewer_config": "繁體中文，獨立審查（忽略歷史報告），證據標註格式：[區塊名稱]Lx-Ly",
    "scoring_details": {
      "dimension_scores": {
        "structure_integrity": "4.5×1.5=6.75",
        "expression_clarity": "4.0×2.0=8.0",
        "constraint_validity": "4.2×2.0=8.4",
        "tool_guidance_completeness": "4.5×1.5=6.75",
        "step_completeness": "4.5×1.5=6.75",
        "practical_feasibility": "4.2×2.0=8.4",
        "token_efficiency": "5.0×1.0=5.0"
      },
      "weighted_sum": 50.05,
      "weight_total": 11.5,
      "overall_calculation": "50.05 / 11.5 = 4.35 ≈ 4.4"
    }
  }
}
