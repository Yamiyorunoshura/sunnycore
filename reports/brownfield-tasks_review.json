{
  "prompt_name": "brownfield-tasks",
  "review_date": "2025-10-01",
  "reviewer": "sunnycore_prompt-reviewer",
  "overall_score": 4.3,
  "pass_threshold": 4.0,
  "status": "合格",
  "dimensions": {
    "structure_integrity": {
      "score": 4.3,
      "weight": 1.0,
      "items": [
        {
          "name": "區段完整性",
          "score": 5.0,
          "evidence": "L1-62：涵蓋輸入(L1-6)、輸出(L8-11)、約束(L13-16)、工具(L18-26)、工具指引(L28-40)、步驟(L42-57)、DoD(L59-62)，結構完整",
          "comment": "所有必要區段齊全，邏輯結構清晰"
        },
        {
          "name": "區段邏輯一致性",
          "score": 4.0,
          "evidence": "L18-26的工具列表與L28-40的工具指引對應清晰；L42-57的步驟與L8-11的輸出對齊",
          "comment": "工具與指引分離但關聯明確，步驟與產出對應良好"
        },
        {
          "name": "輸入驗證機制",
          "score": 4.0,
          "evidence": "L1-6列出輸入檔案，但未明確要求驗證檔案存在性；L44提及「閱讀並理解審查報告」隱含驗證需求",
          "comment": "缺少明確的輸入驗證步驟或約束，建議在[約束]或[步驟1]加入驗證要求"
        }
      ],
      "recommendations": [
        "在[約束]區段加入「必須驗證所有輸入檔案存在且格式正確」",
        "在步驟1加入「驗證輸入檔案：檢查規範、模板、開發筆記、審查報告、架構設計是否齊全」"
      ]
    },
    "semantic_clarity": {
      "score": 3.8,
      "weight": 1.0,
      "items": [
        {
          "name": "指令明確性",
          "score": 4.0,
          "evidence": "L51-52「測試通過條件：指令退出碼必須為 0」、L60-61 DoD明確列出完成標準",
          "comment": "測試標準與完成條件描述精確"
        },
        {
          "name": "術語定義充分性",
          "score": 3.0,
          "evidence": "L47「原子化的修復任務」未定義何謂原子化；L10「建議格式，可根據專案需求調整」缺乏具體格式範例",
          "comment": "關鍵術語缺少定義或範例，可能導致理解差異"
        },
        {
          "name": "步驟可理解性",
          "score": 4.0,
          "evidence": "L43-47準備階段、L49-53修復階段、L55-57總結階段，三階段邏輯清晰",
          "comment": "整體步驟結構易理解，但個別動詞略顯抽象"
        },
        {
          "name": "避免歧義",
          "score": 4.0,
          "evidence": "L10「建議格式，可根據專案需求調整」允許彈性但缺邊界；L46「思考問題所在」為抽象指令",
          "comment": "大部分指令明確，但少數描述略顯模糊"
        }
      ],
      "recommendations": [
        "為L47「原子化的修復任務」補充定義，例如：「單一職責、可獨立測試、變更範圍<100行的修復任務」",
        "L10「修復總結」提供具體格式範例，例如：「## Changes\n- ...\n## Tests\n- ...\n## Evidence\n- file:line\n## Risk\n- ...\n## Rollback\n- ...」",
        "L46將「思考問題所在」改為「分析問題根因：檢查錯誤訊息、堆疊追蹤、程式碼邏輯」"
      ]
    },
    "executability": {
      "score": 4.0,
      "weight": 1.0,
      "items": [
        {
          "name": "步驟可操作性",
          "score": 4.0,
          "evidence": "L43-47準備階段列出具體閱讀對象；L50-53修復階段指定測試指令範例（pytest -q, make test）",
          "comment": "大部分步驟可直接執行，但L46「思考」過於抽象"
        },
        {
          "name": "工具指引具體性",
          "score": 4.5,
          "evidence": "L29-34 sequentialthinking指引明確列出推理步數對應；L35-37 claude-context指引說明使用時機；L38-40 todo_write指引詳述狀態閘門規則",
          "comment": "工具指引清晰且具體，規則明確"
        },
        {
          "name": "產物可驗證性",
          "score": 4.0,
          "evidence": "L59-62 DoD列出3項可驗證標準；L51-52指定測試退出碼=0為通過標準；L56要求證據附帶文件路徑與行號",
          "comment": "產物與測試標準明確，可客觀驗證"
        },
        {
          "name": "異常處理指引",
          "score": 3.5,
          "evidence": "L52「若失敗（退出碼≠0）應使用 git reset 或手動撤銷最近變更並修復後重試」",
          "comment": "提供失敗處理方案，但未說明連續失敗後的升級機制"
        }
      ],
      "recommendations": [
        "在L52補充「若連續3次修復失敗，應記錄問題並請求人工介入」",
        "在[約束]加入「單次修復範圍不超過5個檔案或500行程式碼」以確保原子性"
      ]
    },
    "token_efficiency": {
      "score": 4.5,
      "weight": 1.0,
      "items": [
        {
          "name": "內容簡潔性",
          "score": 4.5,
          "evidence": "L1-62共62行，涵蓋完整流程，無冗長描述",
          "comment": "資訊密度高，表達簡潔"
        },
        {
          "name": "避免冗餘",
          "score": 4.5,
          "evidence": "各區段職責分明，工具與工具指引分離但不重複，步驟描述精煉",
          "comment": "無明顯冗餘內容"
        },
        {
          "name": "資訊密度合理性",
          "score": 4.5,
          "evidence": "平均每行承載明確語義，如L51-52單行表達完整測試標準",
          "comment": "資訊密度適中，易於理解且不失完整性"
        }
      ],
      "recommendations": [
        "維持現有簡潔風格",
        "若未來擴充，考慮將工具指引獨立為附錄以保持主流程簡潔"
      ]
    },
    "evidence_traceability": {
      "score": 4.2,
      "weight": 1.0,
      "items": [
        {
          "name": "證據要求明確性",
          "score": 4.5,
          "evidence": "L37「產出時標註來源文件與行號，以利後續稽核」；L56「應附帶文件路徑與行號/段落ID作為證據；若為版控專案，應附PR/commit連結」",
          "comment": "證據要求清晰且具體，涵蓋多種證據類型"
        },
        {
          "name": "格式標準化",
          "score": 3.5,
          "evidence": "L37提及「文件與行號」但未提供格式範例（如 file:line 或 L8-L11）",
          "comment": "缺少統一的證據引用格式範例，可能導致不一致"
        },
        {
          "name": "可審計性",
          "score": 4.5,
          "evidence": "L56明確要求PR/commit連結；L37說明證據用途「以利後續稽核」；L60-62 DoD可驗證",
          "comment": "審計路徑完整，可追溯變更來源與測試結果"
        }
      ],
      "recommendations": [
        "在L37補充證據格式範例：「格式：`檔案路徑:行號` 或 `L起始-L結束`」",
        "在[輸出]區段加入證據格式示例：「Evidence: src/module.py:45-60, commit:abc123」"
      ]
    },
    "safety_and_compliance": {
      "score": 4.7,
      "weight": 1.0,
      "items": [
        {
          "name": "風險控制機制",
          "score": 4.5,
          "evidence": "L14「確保修復過後的程式碼可以正常運行」；L15「確保修復過後的程式碼符合架構設計」；L16「確保修復過後的程式碼不破壞原有功能」",
          "comment": "明確列出三層風險約束：功能性、架構一致性、相容性"
        },
        {
          "name": "測試要求完整性",
          "score": 5.0,
          "evidence": "L51單元測試要求；L53整合測試要求；L51-52退出碼=0驗證；L60-61 DoD測試標準",
          "comment": "雙層測試（單元+整合）且標準明確，覆蓋完整"
        },
        {
          "name": "回滾機制",
          "score": 4.5,
          "evidence": "L52「若失敗（退出碼≠0）應使用 git reset 或手動撤銷最近變更」；L10修復總結包含「rollback」欄位",
          "comment": "提供明確回滾指令與記錄要求"
        }
      ],
      "recommendations": [
        "在[約束]加入「禁止修改核心API介面」或「變更需經架構驗證」等安全邊界",
        "建議在修復前自動建立備份分支或標籤"
      ]
    }
  },
  "summary": {
    "strengths": [
      "結構完整且邏輯清晰：涵蓋輸入、輸出、約束、工具、步驟、DoD六大區段，分工明確",
      "測試要求嚴謹：雙層測試（單元+整合）且明確指定通過標準（退出碼=0），確保品質",
      "證據追溯性強：明確要求文件路徑、行號、PR/commit連結，便於審計",
      "Token效率高：62行涵蓋完整流程，簡潔且資訊密度高",
      "工具指引詳細：sequentialthinking、claude-context、todo_write三工具規則清晰",
      "安全機制完善：包含風險約束、測試標準、回滾機制"
    ],
    "weaknesses": [
      "關鍵術語缺定義：「原子化的修復任務」未定義，可能導致理解差異",
      "輸出格式略顯模糊：L10「建議格式，可根據專案需求調整」缺具體範例",
      "證據格式未統一：未提供引用格式範例（如 file:line 或 L8-L11）",
      "異常升級機制缺失：未說明連續失敗後的處理流程",
      "輸入驗證不明確：未強制要求驗證檔案存在性"
    ],
    "priority_improvements": [
      {
        "priority": "高",
        "item": "補充「原子化的修復任務」定義",
        "rationale": "核心概念模糊會影響任務拆解品質",
        "suggested_location": "L47或[約束]區段"
      },
      {
        "priority": "高",
        "item": "提供「修復總結」格式範例",
        "rationale": "輸出格式不明確會影響報告一致性與可讀性",
        "suggested_location": "L10或新增[輸出格式範例]區段"
      },
      {
        "priority": "中",
        "item": "統一證據引用格式並提供範例",
        "rationale": "標準化格式有助於自動化解析與審計",
        "suggested_location": "L37補充或新增[證據格式]區段"
      },
      {
        "priority": "中",
        "item": "加入輸入驗證步驟",
        "rationale": "防止因檔案缺失導致流程失敗",
        "suggested_location": "L43步驟1開頭"
      },
      {
        "priority": "低",
        "item": "補充連續失敗升級機制",
        "rationale": "避免無限重試，提升效率",
        "suggested_location": "L52或新增異常處理區段"
      }
    ]
  },
  "destructive_optimization_suggestions": [
    {
      "type": "架構調整",
      "suggestion": "將[工具指引]獨立為附錄或外部參考文件",
      "impact": "破壞現有一體化結構，需調整引用方式",
      "rationale": "當工具指引持續增長時，可能影響主流程可讀性；分離可提升主流程簡潔度",
      "consideration": "若工具種類<5個，建議維持現狀；若>5個，考慮分離"
    },
    {
      "type": "語意轉換",
      "suggestion": "將步驟1-3改為更具體的子任務清單（如：1.1驗證輸入、1.2閱讀審查報告、1.3分析根因...）",
      "impact": "改變現有抽象→具體的敘事風格，可能過於規定性",
      "rationale": "提升可操作性但可能降低彈性，適合固定流程但不利創新式修復",
      "consideration": "適用於標準化修復流程；若需彈性應對複雜問題，現行方式較佳"
    },
    {
      "type": "約束強化",
      "suggestion": "將[約束]改為強制檢查點（Checkpoint），在步驟中插入驗證節點",
      "impact": "改變約束為被動→主動驗證，需重構步驟流程",
      "rationale": "提升約束執行力，但增加流程複雜度",
      "consideration": "適合高風險專案；一般專案現行方式已足夠"
    }
  ],
  "metadata": {
    "prompt_version": "unknown",
    "prompt_path": "claude code/tasks/brownfield-tasks.md",
    "total_lines": 62,
    "review_methodology": "6維度20項審查標準，採0-5評分制",
    "reviewer_config": "繁體中文，證據以行號標註（L起始-L結束）"
  }
}
